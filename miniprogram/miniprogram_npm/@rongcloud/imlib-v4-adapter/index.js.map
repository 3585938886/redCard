{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA","file":"index.js","sourcesContent":["Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"@rongcloud/engine\"),t=function(){return t=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},t.apply(this,arguments)};function o(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))}function n(e,t){var o,n,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},\"function\"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(o)throw new TypeError(\"Generator is already executing.\");for(;a;)try{if(o=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{o=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}}function r(e,t,o){if(o||2===arguments.length)for(var n,r=0,s=t.length;r<s;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}var s=function(){return!(\"undefined\"==typeof uni||!function(e){for(var t=[\"request\",\"getSystemInfo\"],o=0,n=t.length;o<n;o++)if(!e[t[o]])return!1;return!0}(uni))},a=s();var i={tag:\"browser\",httpReq:function(t){var o=t.method||e.HttpMethod.GET,n=t.timeout||6e4,r=t.headers,s=t.query,a=t.body,i=e.appendUrl(t.url,s);return new Promise((function(e){var t,s=(t=\"undefined\"!=typeof XMLHttpRequest&&\"withCredentials\"in new XMLHttpRequest,\"undefined\"!=typeof XMLHttpRequest&&t?new XMLHttpRequest:\"undefined\"!=typeof XDomainRequest?new XDomainRequest:new ActiveXObject(\"Microsoft.XMLHTTP\")),c=\"[object XDomainRequest]\"===Object.prototype.toString.call(s);if(s.open(o,i),r&&s.setRequestHeader)for(var u in r)s.setRequestHeader(u,r[u]);if(c){s.timeout=n,s.onload=function(){e({data:s.responseText,status:s.status||200})},s.onerror=function(){e({status:s.status||0})},s.ontimeout=function(){e({status:s.status||0})};var d=\"object\"==typeof a?JSON.stringify(a):a;s.send(d)}else s.onreadystatechange=function(){4===s.readyState&&e({data:s.responseText,status:s.status})},s.onerror=function(){e({status:s.status||0})},setTimeout((function(){s.abort(),e({status:s.status||0})}),n),s.send(a)}))},localStorage:null===window||void 0===window?void 0:window.localStorage,sessionStorage:null===window||void 0===window?void 0:window.sessionStorage,isSupportSocket:function(){var e=\"undefined\"!=typeof WebSocket;return e||console.warn(\"websocket not support\"),e},useNavi:!0,connectPlatform:\"\",isFromUniapp:a,createWebSocket:function(e,t){var o=new WebSocket(e,t);return o.binaryType=\"arraybuffer\",{onClose:function(e){o.onclose=function(t){var o=t.code,n=t.reason;e(o,n)}},onError:function(e){o.onerror=e},onMessage:function(e){o.onmessage=function(t){e(t.data)}},onOpen:function(e){o.onopen=e},send:function(e){o.send(e)},close:function(e,t){o.close()}}},createDataChannel:function(t,o){return this.isSupportSocket()&&\"websocket\"===o?new e.WebSocketChannel(this,t):new e.CometChannel(this,t)},getNetworkType:function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection,o=t.type,n=t.effectiveType,r=o||n||e.NetworkType.UNKONWN;return new Promise((function(e){e(r)}))}},c=s(),u=function(t){return function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var r=e.logger.ID();try{return e.logger.info(e.LogTagId.A_CALLBACK_O,{func_name:t,source:\"wechat\"},{traceId:r}),wx[t].apply(wx,o)}catch(o){e.logger.error(e.LogTagId.A_CALLBACK_E,{func_name:t,source:\"wechat\"},{traceId:r}),console.error(o)}}},d={setItem:u(\"setStorageSync\"),getItem:u(\"getStorageSync\"),removeItem:u(\"removeStorageSync\"),clear:u(\"clearStorageSync\")},g={tag:\"wechat\",httpReq:function(t){var o=t.method||e.HttpMethod.GET,n=t.timeout||6e4,r=t.headers,s=t.query,a=t.body,i=e.appendUrl(t.url,s);return new Promise((function(t){wx.request({url:i,method:o,header:r,timeout:n,data:a,success:function(e){t({data:e.data,status:e.statusCode})},fail:function(){t({status:e.ErrorCode.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:d,sessionStorage:d,isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:\"MiniProgram\",isFromUniapp:c,createWebSocket:function(e,t){var o=wx.connectSocket({url:e,protocols:t});return{onClose:function(e){o.onClose((function(t){e(t.code,t.reason)}))},onError:function(e){o.onError((function(t){e(t.errMsg)}))},onMessage:function(e){o.onMessage((function(t){e(t.data)}))},onOpen:function(e){o.onOpen(e)},send:function(e){o.send({data:e})},close:function(e,t){o.close({code:e,reason:t})}}},createDataChannel:function(t,o){return\"websocket\"===o?new e.WebSocketChannel(this,t):new e.CometChannel(this,t)},getNetworkType:function(){return new Promise((function(t){wx.getNetworkType({success:function(e){var o=e.networkType;t(o)},fail:function(){t(e.NetworkType.UNKONWN)}})}))}},p=s(),l=function(t){return function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var r=e.logger.ID();try{if(e.logger.info(e.LogTagId.A_CALLBACK_O,{func_name:t,source:\"alipay\"},{traceId:r}),\"setStorageSync\"===t)return my[t]({key:o[0],data:JSON.parse(o[1])});if(\"clearStorageSync\"===t)return my[t]();if(\"removeStorageSync\"===t)return my[t]({key:o[0]});var s=my[t]({key:o[0]}).data;return s?JSON.stringify(s):s}catch(o){e.logger.error(e.LogTagId.A_CALLBACK_E,{func_name:t,source:\"alipay\"},{traceId:r}),console.error(o)}}},f={setItem:l(\"setStorageSync\"),getItem:l(\"getStorageSync\"),removeItem:l(\"removeStorageSync\"),clear:l(\"clearStorageSync\")},h={tag:\"alipay\",httpReq:function(t){var o=t.method||e.HttpMethod.GET,n=t.timeout||6e4,r=t.headers,s=t.query,a=t.body,i=e.appendUrl(t.url,s),c=t.dataType||\"json\";return new Promise((function(t){my.request({url:i,method:o,headers:r,timeout:n,data:a,dataType:c,success:function(e){t({data:e.data,status:e.status})},fail:function(){t({status:e.ErrorCode.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:f,sessionStorage:f,isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:\"MiniProgram\",isFromUniapp:p,createWebSocket:function(e){return my.connectSocket({url:e}),{onClose:function(e){my.onSocketClose(e)},onError:function(e){my.onSocketError((function(t){e(t.errMsg)}))},onMessage:function(e){my.onSocketMessage((function(t){t.isBuffer?e(my.base64ToArrayBuffer(t.data)):e(t.data)}))},onOpen:function(e){my.onSocketOpen(e)},send:function(e){my.sendSocketMessage({data:my.arrayBufferToBase64(e),isBuffer:!0})},close:function(){my.closeSocket()}}},createDataChannel:function(t,o){return\"websocket\"===o?new e.WebSocketChannel(this,t):new e.CometChannel(this,t)},getNetworkType:function(){return new Promise((function(t){my.getNetworkType({success:function(e){var o=e.networkType;t(o)},fail:function(){t(e.NetworkType.UNKONWN)}})}))}},m=s(),C=function(t){return function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var r=e.logger.ID();try{return e.logger.info(e.LogTagId.A_CALLBACK_O,{func_name:t,source:\"toutiao\"},{traceId:r}),tt[t].apply(tt,o)}catch(o){e.logger.error(e.LogTagId.A_CALLBACK_E,{func_name:t,source:\"toutiao\"},{traceId:r}),console.error(o)}}},I={setItem:C(\"setStorageSync\"),getItem:C(\"getStorageSync\"),removeItem:C(\"removeStorageSync\"),clear:C(\"clearStorageSync\")},v={tag:\"toutiao\",isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:\"MiniProgram\",isFromUniapp:m,localStorage:I,sessionStorage:I,httpReq:function(e){return new Promise((function(t,o){tt.request({url:e.url,data:e.body,header:e.headers,method:e.method,success:function(e){console.log(\"调用成功\",e.data);var o=(null==e?void 0:e.data)||{},n={data:JSON.stringify(o),status:e.statusCode};t(n)},fail:function(e){console.log(\"调用失败\",e.errMsg),o({data:e.errMsg})}})}))},createWebSocket:function(e,t){var o=tt.connectSocket({url:e,protocols:t});return{onOpen:function(e){o.onOpen(e)},onClose:function(e){o.onClose((function(t){return e(t.code,t.reason)}))},onError:function(e){o.onError((function(t){return e(t.errMsg)}))},onMessage:function(e){o.onMessage((function(t){return e(t.data)}))},send:function(e){o.send({data:e})},close:function(e,t){o.close({code:e,reason:t})}}},createDataChannel:function(t,o){return\"websocket\"===o?new e.WebSocketChannel(this,t):new e.CometChannel(this,t)},getNetworkType:function(){return new Promise((function(t){tt.getNetworkType({success:function(e){var o=e.networkType;t(o)},fail:function(){t(e.NetworkType.UNKONWN)}})}))}},S=s(),y=function(t){return function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var r=e.logger.ID();try{return e.logger.info(e.LogTagId.A_CALLBACK_O,{func_name:t,source:\"baidu\"},{traceId:r}),swan[t].apply(swan,o)}catch(o){e.logger.error(e.LogTagId.A_CALLBACK_E,{func_name:t,source:\"baidu\"},{traceId:r}),console.error(o)}}},T={setItem:y(\"setStorageSync\"),getItem:y(\"getStorageSync\"),removeItem:y(\"removeStorageSync\"),clear:y(\"clearStorageSync\")},E={tag:\"baidu\",isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:\"MiniProgram\",isFromUniapp:S,localStorage:T,sessionStorage:T,httpReq:function(e){return new Promise((function(t,o){swan.request({url:e.url,data:e.body,header:e.headers,method:e.method,success:function(e){console.log(\"调用成功\",e.data);var o=(null==e?void 0:e.data)||{},n={data:JSON.stringify(o),status:e.statusCode};t(n)},fail:function(e){console.log(\"调用失败\",e.errorCode),o({data:e.errorCode})}})}))},createWebSocket:function(e,t){var o=swan.connectSocket({url:e,protocols:t});return{onOpen:function(e){o.onOpen(e)},onClose:function(e){o.onClose((function(t){return e(t.code,t.reason)}))},onError:function(e){o.onError((function(t){return e(t.errMsg)}))},onMessage:function(e){o.onMessage((function(t){return e(t.data)}))},send:function(e){o.send({data:e})},close:function(e,t){o.close({code:e,reason:t})}}},createDataChannel:function(t,o){return\"websocket\"===o?new e.WebSocketChannel(this,t):new e.CometChannel(this,t)},getNetworkType:function(){return o(this,void 0,void 0,(function(){return n(this,(function(t){return[2,new Promise((function(t){swan.getNetworkType({success:function(e){var o=e.networkType;t(o)},fail:function(){t(e.NetworkType.UNKONWN)}})}))]}))}))}},_=function(t){return function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var r=e.logger.ID();try{return e.logger.info(e.LogTagId.A_CALLBACK_O,{func_name:t,source:\"uniapp\"},{traceId:r}),uni[t].apply(uni,o)}catch(o){e.logger.error(e.LogTagId.A_CALLBACK_E,{func_name:t,source:\"uniapp\"},{traceId:r}),console.error(o)}}},R={setItem:_(\"setStorageSync\"),getItem:_(\"getStorageSync\"),removeItem:_(\"removeStorageSync\"),clear:_(\"clearStorageSync\")},O={tag:\"uniapp\",httpReq:function(t){var o=t.method||e.HttpMethod.GET,n=t.timeout||6e4,r=t.headers,s=t.query,a=t.body,i=e.appendUrl(t.url,s);return new Promise((function(t){uni.request({url:i,method:o,header:r,timeout:n,data:a,success:function(e){t({data:e.data,status:e.statusCode})},fail:function(){t({status:e.ErrorCode.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:R,sessionStorage:R,isSupportSocket:function(){return!0},useNavi:!0,connectPlatform:\"\",isFromUniapp:!0,createWebSocket:function(e,t){var o={complete:function(){},url:e,protocols:t},n=uni.connectSocket(o);return{onClose:function(e){n.onClose((function(t){e(t.code,t.reason)}))},onError:function(e){n.onError((function(t){e(t.errMsg)}))},onMessage:function(e){n.onMessage((function(t){e(t.data)}))},onOpen:function(e){n.onOpen(e)},send:function(e){n.send({data:e})},close:function(e,t){n.close({code:e,reason:t})}}},createDataChannel:function(t,o){return\"websocket\"===o?new e.WebSocketChannel(this,t):new e.CometChannel(this,t)},getNetworkType:function(){return new Promise((function(t){uni.getNetworkType({success:function(e){var o=e.networkType;t(o)},fail:function(){t(e.NetworkType.UNKONWN)}})}))}},N=function(e){return e&&e.request&&e.getSystemInfo},A=\"undefined\"!=typeof uni&&N(uni)?function(){switch(process.env.VUE_APP_PLATFORM){case\"app-plus\":return O;case\"mp-baidu\":return E;case\"mp-toutiao\":return v;case\"mp-alipay\":return h;case\"mp-weixin\":return g;default:return i}}():\"undefined\"!=typeof my&&N(my)?h:\"undefined\"!=typeof tt&&N(tt)?v:\"undefined\"!=typeof swan&&N(swan)?E:\"undefined\"!=typeof wx&&N(wx)?g:i,w=new e.Logger(\"RCIM\"),M={TIMEOUT:{code:-1,msg:\"Network timeout\"},SDK_INTERNAL_ERROR:{code:-2,msg:\"SDK internal error\"},PARAMETER_ERROR:{code:-3,msg:\"Please check the parameters, the {param} expected a value of {expect} but received {current}\"},REJECTED_BY_BLACKLIST:{code:405,msg:\"Blacklisted by the other party\"},SEND_TOO_FAST:{code:20604,msg:\"Sending messages too quickly\"},NOT_IN_GROUP:{code:22406,msg:\"Not in group\"},FORBIDDEN_IN_GROUP:{code:22408,msg:\"Forbbiden from speaking in the group\"},NOT_IN_CHATROOM:{code:23406,msg:\"Not in chatRoom\"},FORBIDDEN_IN_CHATROOM:{code:23408,msg:\"Forbbiden from speaking in the chatRoom\"},KICKED_FROM_CHATROOM:{code:23409,msg:\"Kicked out and forbbiden from joining the chatRoom\"},CHATROOM_NOT_EXIST:{code:23410,msg:\"ChatRoom does not exist\"},CHATROOM_IS_FULL:{code:23411,msg:\"ChatRoom members exceeded\"},PARAMETER_INVALID_CHATROOM:{code:23412,msg:\"Invalid chatRoom parameters\"},ROAMING_SERVICE_UNAVAILABLE_CHATROOM:{code:23414,msg:\"ChatRoom message roaming service is not open, Please go to the developer to open this service\"},RECALLMESSAGE_PARAMETER_INVALID:{code:25101,msg:\"Invalid recall message parameter\"},ROAMING_SERVICE_UNAVAILABLE_MESSAGE:{code:25102,msg:\"Single group chat roaming service is not open, Please go to the developer to open this service\"},PUSHSETTING_PARAMETER_INVALID:{code:26001,msg:\"Invalid push parameter\"},OPERATION_BLOCKED:{code:20605,msg:\"Operation is blocked\"},OPERATION_NOT_SUPPORT:{code:20606,msg:\"Operation is not supported\"},MSG_BLOCKED_SENSITIVE_WORD:{code:21501,msg:\"The sent message contains sensitive words\"},REPLACED_SENSITIVE_WORD:{code:21502,msg:\"Sensitive words in the message have been replaced\"},NOT_CONNECTED:{code:30001,msg:\"Please connect successfully first\"},NAVI_REQUEST_ERROR:{code:30007,msg:\"Navigation http request failed\"},CMP_REQUEST_ERROR:{code:30010,msg:\"CMP sniff http request failed\"},CONN_APPKEY_FAKE:{code:31002,msg:\"Your appkey is fake\"},CONN_MINI_SERVICE_NOT_OPEN:{code:31003,msg:\"Mini program service is not open, Please go to the developer to open this service\"},CONN_ACK_TIMEOUT:{code:31e3,msg:\"Connection ACK timeout\"},CONN_TOKEN_INCORRECT:{code:31004,msg:\"Your token is not valid or expired\"},CONN_NOT_AUTHRORIZED:{code:31005,msg:\"AppKey and Token do not match\"},CONN_REDIRECTED:{code:31006,msg:\"Connection redirection\"},CONN_APP_BLOCKED_OR_DELETED:{code:31008,msg:\"AppKey is banned or deleted\"},CONN_USER_BLOCKED:{code:31009,msg:\"User blocked\"},CONN_DOMAIN_INCORRECT:{code:31012,msg:\"Connect domain error, Please check the set security domain\"},ROAMING_SERVICE_UNAVAILABLE:{code:33007,msg:\"Roaming service cloud is not open, Please go to the developer to open this service\"},RC_CONNECTION_EXIST:{code:34001,msg:\"Connection already exists\"},CHATROOM_KV_EXCEED:{code:23423,msg:\"ChatRoom KV setting exceeds maximum\"},CHATROOM_KV_OVERWRITE_INVALID:{code:23424,msg:\"ChatRoom KV already exists\"},CHATROOM_KV_STORE_NOT_OPEN:{code:23426,msg:\"ChatRoom KV storage service is not open, Please go to the developer to open this service\"},CHATROOM_KEY_NOT_EXIST:{code:23427,msg:\"ChatRoom key does not exist\"},MSG_KV_NOT_SUPPORT:{code:34008,msg:\"The message cannot be extended\"},SEND_MESSAGE_KV_FAIL:{code:34009,msg:\"Sending RC expansion message fail\"},EXPANSION_LIMIT_EXCEET:{code:34010,msg:\"The message expansion size is beyond the limit\"},ILLGAL_PARAMS:{code:33003,msg:\"Incorrect parameters passed in while calling the interface\"},CHATROOM_KV_STORE_NOT_ALL_SUCCESS:{code:23428,msg:\"Chatroom kv store not all success\"},CHATROOM_KV_STORE_OUT_LIMIT:{code:23429,msg:\"chatroom kv's length is out of limit\"}},b={};for(var U in M){var x=M[U].code;b[x]=U}M.ROAMING_SERVICE_UNAVAILABLE.code;function P(t){var o=t.conversationType,n=t.messageType,r=t.content,s=t.senderUserId,a=t.targetId,i=t.sentTime,c=t.receivedTime,u=t.messageUId,d=t.messageDirection,g=t.isPersited,p=t.isCounted,l=t.isOffLineMessage,f=t.canIncludeExpansion,h=t.expansion,m=t.receivedStatus,C=t.disableNotification,I=t.isMentioned,v=t.isStatusMessage,S=t.readReceiptInfo;return m||(m=e.ReceivedStatus.UNREAD),{messageType:n,content:r,senderUserId:s,targetId:a,type:o,sentTime:i,receivedTime:c,messageUId:u,messageDirection:d,isPersited:g,isCounted:p,isOffLineMessage:l,isMentioned:I,disableNotification:C,isStatusMessage:v,canIncludeExpansion:f,expansion:h,receivedStatus:m,readReceiptInfo:S}}function L(e){var t=e.conversationType,o=e.targetId,n=e.latestMessage,r=e.unreadMessageCount,s=e.hasMentioned,a=e.mentionedInfo,i=e.lastUnreadTime,c=e.notificationStatus,u=e.isTop;return{type:t,targetId:o,latestMessage:n&&P(n),unreadMessageCount:r,hasMentioned:s,mentionedInfo:s?{type:null==a?void 0:a.type,userIdList:null==a?void 0:a.userIdList}:void 0,lastUnreadTime:i,notificationStatus:c,isTop:u}}function k(t){e.assert(\"options.messageType\",t.messageType,e.AssertRules.STRING,!0),e.assert(\"options.content\",t.content,(function(t){return e.isObject(t)}),!0),e.assert(\"options.isPersited\",t.isPersited,e.AssertRules.BOOLEAN),e.assert(\"options.isCounted\",t.isCounted,e.AssertRules.BOOLEAN),e.assert(\"options.pushContent\",t.pushContent,e.AssertRules.STRING),e.assert(\"options.pushData\",t.pushData,e.AssertRules.STRING),e.assert(\"options.isVoipPush\",t.isVoipPush,e.AssertRules.BOOLEAN),e.assert(\"options.isStatusMessage\",t.isStatusMessage,e.AssertRules.BOOLEAN),e.assert(\"options.isMentioned\",t.isMentioned,e.AssertRules.BOOLEAN),e.assert(\"options.mentionedType\",t.mentionedType,e.AssertRules.NUMBER),e.assert(\"options.mentionedUserIdList\",t.mentionedUserIdList,(function(t){return e.isArray(t)&&(0===t.length||t.every(e.isString))})),e.assert(\"options.directionalUserIdList\",t.directionalUserIdList,(function(t){return e.isArray(t)&&(0===t.length||t.every(e.isString))})),e.isUndefined(t.isPersited)&&e.isUndefined(t.isCounted)&&e.isUndefined(t.isStatusMessage)||w.warn(\"The parameters `isPersited`, `isCounted`, `isStatusMessage` will be deprecated in future releases due to inconsistance of the values on mobile side and web side. Please use `registerMessageType` instead for non-integrated message type.\")}var D=function(e,t){if(!e)return[];var o=j(e),n=G(o.topConversationList,t),r=G(o.unToppedConversationList,t);return n.push.apply(n,r),n},j=function(t){var o=[],n=[];return e.forEach(t,(function(e){var t=e.hasMentioned,r=e.mentionedInfo;e.hasMentioned=t,e.mentionedInfo=r,e.isTop||!1?o.push(e):n.push(e)})),{topConversationList:o||[],unToppedConversationList:n||[]}},B=function(e){var t=e.type,o=e.targetId;return\"\".concat(t,\"_\").concat(o)},G=function(e,t){return void 0===t&&(t=0),H(e,(function(e,o){o=o||{};var n=(e=e||{}).latestMessage||{},r=o.latestMessage||{},s=n.sentTime||0,a=r.sentTime||0;return t?a>=s:a<=s}))},K=function(t){var o=(t=t||{}).targetId,n=t.type,r=e.ConversationType.PRIVATE,s={messageType:e.MessageType.TextMessage,sentTime:e.DelayTimer.getTime(),content:{content:\"\"},senderUserId:o,targetId:o,type:n};return t.type=n||r,t.targetId=o||\"\",t.latestMessage=t.latestMessage||s,t},H=function(e,t){var o=function(e,t,n,r){if(r=r||function(e,t){return e<=t},t<n){for(var s=e[n],a=t-1,i=void 0,c=t;c<=n;c++)r(e[c],s)&&(i=e[++a],e[a]=e[c],e[c]=i);o(e,t,a-1,r),o(e,a+1,n,r)}return e};return o(e,0,e.length-1,t)},V=function(t){return!t.type||!t.targetId||!e.isObject(t.latestMessage)||e.isUndefined(t.unreadMessageCount)},F=function(t,o,n){var r=(n=n||{}).isAllowNull;for(var s in t=t||{},o=o||{}){var a=o[s];e.isUndefined(a)&&!r||(t[s]=a)}return t},q=function(e){return{targetId:e.targetId,channelId:e.channelId,conversationType:e.type}},W=function(){function t(e,t){this._context=e,this.targetId=t.targetId,this.type=t.type}return t.prototype.destory=function(){return o(this,void 0,void 0,(function(){var t,o;return n(this,(function(n){switch(n.label){case 0:return[4,this._context.removeConversation(this.type,this.targetId)];case 1:return t=n.sent(),o=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId),w.debug(\"destroy conversation ->\".concat(o)),t!==e.ErrorCode.SUCCESS?(w.warn(\"destroy conversation fail ->\".concat(t,\":\").concat(b[t],\",\").concat(o)),[2,Promise.reject({code:t,msg:b[t]})]):[2]}}))}))},t.prototype.read=function(){return o(this,void 0,void 0,(function(){var t,o;return n(this,(function(n){switch(n.label){case 0:return[4,this._context.clearUnreadCount(this.type,this.targetId)];case 1:return t=n.sent(),o=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId),w.debug(\"clear unreadMsgNum ->\".concat(o)),t!==e.ErrorCode.SUCCESS?(w.warn(\"clear unreadMsgNum fail ->\".concat(t,\":\").concat(b[t],\",\").concat(o)),[2,Promise.reject({code:t,msg:b[t]})]):[2]}}))}))},t.prototype.getUnreadCount=function(){return o(this,void 0,void 0,(function(){var t,o,r,s;return n(this,(function(n){switch(n.label){case 0:return[4,this._context.getUnreadCount(this.type,this.targetId)];case 1:return t=n.sent(),o=t.code,r=t.data,s=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId),w.debug(\"get unreadCount ->\".concat(s)),o===e.ErrorCode.SUCCESS?[2,r]:(w.warn(\"get unreadCount fail ->\".concat(o,\":\").concat(b[o],\",\").concat(s)),[2,Promise.reject({code:o,msg:b[o]})])}}))}))},t.prototype.send=function(t){return o(this,void 0,void 0,(function(){var o,r,s,a,i;return n(this,(function(n){switch(n.label){case 0:return k(t),Object.prototype.hasOwnProperty.call(t,\"isPersited\")||(t.isPersited=!0),Object.prototype.hasOwnProperty.call(t,\"isCounted\")||(t.isCounted=!0),o=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId),w.debug(\"send message  ->\".concat(o)),r=e.logger.ID(),e.logger.info(e.LogTagId.A_SEND_MSG_T,{messageType:t.messageType,conversationType:this.type,target:this.targetId,channelId:t.channelId},{traceId:r}),[4,this._context.sendMessage(this.type,this.targetId,t,void 0,r)];case 1:return s=n.sent(),a=s.code,i=s.data,(a===e.ErrorCode.SUCCESS?e.logger.info:e.logger.warn)(e.LogTagId.A_SEND_MSG_R,{code:a,messageUId:i?i.messageUId:\"\",messageId:i?i.messageId:\"\"},{traceId:r}),a===e.ErrorCode.SUCCESS?[2,P(i)]:(w.warn(\"send message fail ->\".concat(a,\":\").concat(b[a],\",\").concat(o)),[2,Promise.reject({code:a,msg:b[a],data:P({isMentioned:!!t.isMentioned,content:t.content,messageType:t.messageType,isPersited:t.isPersited||!1,isCounted:t.isCounted||!1,disableNotification:!!(null==t?void 0:t.disableNotification),canIncludeExpansion:!!(null==t?void 0:t.canIncludeExpansion),expansion:(null==t?void 0:t.expansion)||null,conversationType:this.type,targetId:this.targetId,senderUserId:this._context.getCurrentUserId(),messageUId:\"\",messageDirection:e.MessageDirection.SEND,isOffLineMessage:!1,sentTime:(null==i?void 0:i.sentTime)||0,receivedTime:0,isStatusMessage:t.isStatusMessage||!1,receivedStatus:e.ReceivedStatus.UNREAD})})])}}))}))},t.prototype.setStatus=function(t){return o(this,void 0,void 0,(function(){var o,r;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"options.notificationStatus\",t.notificationStatus,(function(e){return 1===e||2===e})),e.assert(\"options.isTop\",t.isTop,e.AssertRules.BOOLEAN),o=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId),w.debug(\"set conversation status ->\".concat(o)),[4,this._context.setConversationStatus(this.type,this.targetId,t.isTop,t.notificationStatus)];case 1:return(r=n.sent())!==e.ErrorCode.SUCCESS?(w.warn(\"set conversation status fail ->\".concat(r,\":\").concat(b[r],\",\").concat(o)),[2,Promise.reject({code:r,msg:b[r]})]):[2]}}))}))},t.prototype.getMessages=function(t){return o(this,void 0,void 0,(function(){var o,r,s,a,i,c,u;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"options.timestamp\",t.timestamp,e.AssertRules.NUMBER),e.assert(\"options.count\",t.count,e.AssertRules.NUMBER),e.assert(\"options.order\",t.order,(function(e){return 0===e||1===e})),o=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId),w.debug(\"get history message ->\".concat(o)),r=e.logger.ID(),e.logger.info(e.LogTagId.A_GET_HISTORY_MSG_T,{targetId:this.targetId,conversationType:this.type,channelId:\"\",timestamp:t.timestamp,count:t.count},{traceId:r}),[4,this._context.getHistoryMessage(this.type,this.targetId,null==t?void 0:t.timestamp,null==t?void 0:t.count,null==t?void 0:t.order)];case 1:return s=n.sent(),a=s.code,i=s.data,a===e.ErrorCode.SUCCESS&&i?(c=[],u=i.list.map((function(e){var t=P(e);return c.push(t.messageUId),t})),e.logger.info(e.LogTagId.A_GET_HISTORY_MSG_R,{code:a,messageUIds:c.join(\",\")},{traceId:r}),[2,Promise.resolve({list:u,hasMore:i.hasMore})]):(e.logger.warn(e.LogTagId.A_GET_HISTORY_MSG_R,{code:a,messageUIds:\"\"},{traceId:r}),w.warn(\"get history message fail ->\".concat(a,\":\").concat(b[a],\",\").concat(o)),[2,Promise.reject({code:a,msg:b[a]})])}}))}))},t.prototype.recall=function(t){return o(this,void 0,void 0,(function(){var o,r,s,a,i;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"options.messageUId\",t.messageUId,e.AssertRules.STRING,!0),e.assert(\"options.sentTime\",t.sentTime,e.AssertRules.NUMBER,!0),e.assert(\"options.disableNotification\",null==t?void 0:t.disableNotification,e.AssertRules.BOOLEAN),e.assert(\"options.pushConfig\",null==t?void 0:t.pushConfig,e.AssertRules.OBJECT),e.assert(\"options.extra\",null==t?void 0:t.extra,e.AssertRules.STRING),o={user:t.user,channelId:\"\",disableNotification:null==t?void 0:t.disableNotification,pushConfig:null==t?void 0:t.pushConfig,extra:t.extra},r=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId,\",messageUId:\").concat(t.messageUId),w.debug(\"recall message ->\".concat(r)),[4,this._context.recallMessage(this.type,this.targetId,t.messageUId,t.sentTime,o)];case 1:return s=n.sent(),a=s.code,i=s.data,a===e.ErrorCode.SUCCESS&&i?[2,P(i)]:(w.warn(\"recall message fail ->\".concat(a,\":\").concat(b[a],\",\").concat(r)),[2,Promise.reject({code:a,msg:b[a]})])}}))}))},t.prototype.deleteMessages=function(t){return o(this,void 0,void 0,(function(){var o,r;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"options\",t,(function(t){return e.isArray(t)&&t.length}),!0),t.forEach((function(t){e.assert(\"options.messageUId\",t.messageUId,e.AssertRules.STRING,!0),e.assert(\"options.sentTime\",t.sentTime,e.AssertRules.NUMBER,!0),e.assert(\"options.messageDirection\",t.messageDirection,(function(e){return 1===e||2===e}),!0)})),o=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId),w.debug(\"delete messages ->\".concat(o)),[4,this._context.deleteRemoteMessage(this.type,this.targetId,t)];case 1:return(r=n.sent())!==e.ErrorCode.SUCCESS?(w.warn(\"delete message fail ->\".concat(r,\":\").concat(b[r],\",\").concat(o)),[2,Promise.reject({code:r,msg:b[r]})]):[2]}}))}))},t.prototype.clearMessages=function(t){return o(this,void 0,void 0,(function(){var o,r;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"options.timestamp\",t.timestamp,e.AssertRules.NUMBER,!0),o=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId),w.debug(\"clear message ->\".concat(o)),[4,this._context.deleteRemoteMessageByTimestamp(this.type,this.targetId,t.timestamp)];case 1:return(r=n.sent())!==e.ErrorCode.SUCCESS?(w.warn(\"clear message ->\".concat(r,\":\").concat(b[r],\",\").concat(o)),[2,Promise.reject({code:r,msg:b[r]})]):[2]}}))}))},t.prototype.updateMessageExpansion=function(t,r){return o(this,void 0,void 0,(function(){var o,s,a,i,c,u,d;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"expansion\",t,e.AssertRules.OBJECT,!0),e.assert(\"message\",r,e.AssertRules.OBJECT,!0),o=r.type,s=r.targetId,a=r.messageUId,i=r.canIncludeExpansion,c=r.expansion,u=\"type:\".concat(o,\",targetId:\").concat(this.targetId,\",messageUId:\").concat(a),w.debug(\"update message expansion ->\".concat(u)),[4,this._context.sendExpansionMessage({conversationType:o,targetId:s,messageUId:a,expansion:t,canIncludeExpansion:i,originExpansion:c,channelId:\"\"})];case 1:return(d=n.sent().code)!==e.ErrorCode.SUCCESS?(w.warn(\"update message expansion fail ->\".concat(d,\":\").concat(b[d],\",\").concat(u)),[2,Promise.reject({code:d,msg:b[d]})]):[2]}}))}))},t.prototype.removeMessageExpansion=function(t,r){return o(this,void 0,void 0,(function(){var o,s,a,i,c,u;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"keys\",t,e.AssertRules.ARRAY,!0),e.assert(\"message\",r,e.AssertRules.OBJECT,!0),o=r.type,s=r.targetId,a=r.messageUId,i=r.canIncludeExpansion,c=\"type:\".concat(o,\",targetId:\").concat(this.targetId,\",messageUId:\").concat(a),w.debug(\"remove message expansion ->\".concat(c)),[4,this._context.sendExpansionMessage({conversationType:o,targetId:s,messageUId:a,canIncludeExpansion:i,keys:t,channelId:\"\"})];case 1:return(u=n.sent().code)!==e.ErrorCode.SUCCESS?(w.warn(\"remove message expansion fail ->\".concat(u,\":\").concat(b[u],\",\").concat(c)),[2,Promise.reject({code:u,msg:b[u]})]):[2]}}))}))},t.prototype.setDraft=function(t){return o(this,void 0,void 0,(function(){var o,r;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"draft\",t,e.AssertRules.STRING,!0),o=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId),w.debug(\"set draft ->\".concat(o)),[4,this._context.saveConversationMessageDraft(this.type,this.targetId,t)];case 1:return(r=n.sent())===e.ErrorCode.SUCCESS?[2,Promise.resolve()]:(w.warn(\"set draft fail ->\".concat(r,\":\").concat(b[r],\",\").concat(o)),[2])}}))}))},t.prototype.getDraft=function(){return o(this,void 0,void 0,(function(){var t,o,r,s;return n(this,(function(n){switch(n.label){case 0:return[4,this._context.getConversationMessageDraft(this.type,this.targetId)];case 1:return t=n.sent(),o=t.code,r=t.data,s=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId),w.debug(\"get draft ->\".concat(s)),o===e.ErrorCode.SUCCESS?[2,Promise.resolve(r)]:(w.warn(\"get draft fail ->\".concat(o,\":\").concat(b[o],\",\").concat(s)),[2,Promise.reject({code:o,msg:b[o]})])}}))}))},t.prototype.deleteDraft=function(){return o(this,void 0,void 0,(function(){var t,o;return n(this,(function(n){switch(n.label){case 0:return t=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId),w.debug(\"delete draft  ->\".concat(t)),[4,this._context.clearConversationMessageDraft(this.type,this.targetId)];case 1:return(o=n.sent())===e.ErrorCode.SUCCESS?[2,Promise.resolve()]:(w.warn(\"delete draft fail ->\".concat(o,\":\").concat(b[o],\",\").concat(t)),[2])}}))}))},t.prototype.sendReadReceiptMessage=function(t){return o(this,void 0,void 0,(function(){var o,r,s,a,i;return n(this,(function(n){switch(n.label){case 0:for(e.assert(\"messageUIds\",t,e.AssertRules.ARRAY,!0),o=0,r=t;o<r.length;o++)s=r[o],e.assert(\"messageUId\",s,e.AssertRules.STRING);return a=\"messageUIds:\".concat(t.join(\",\"),\",targetId:\").concat(this.targetId),w.debug(\"send read receipt message ->\".concat(a)),[4,this._context.sendReadReceiptMessage(this.targetId,t)];case 1:return(i=n.sent().code)===e.ErrorCode.SUCCESS?[2,Promise.resolve()]:(w.warn(\"send read receipt message fail ->\".concat(i,\":\").concat(b[i],\",\").concat(a)),[2,Promise.reject(i)])}}))}))},t.prototype.sendTypingStatusMessage=function(t){return o(this,void 0,void 0,(function(){var o,r,s,a,i,c;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"typingContentType\",t,e.AssertRules.STRING,!0),o=\"type:\".concat(this.type,\",targetId:\").concat(this.targetId),w.debug(\"send typing status message ->\".concat(o)),r={messageType:\"RC:TypSts\",content:{typingContentType:t},isStatusMessage:!0,channelId:\"\"},s=e.logger.ID(),e.logger.info(e.LogTagId.A_SEND_MSG_T,{messageType:r.messageType,conversationType:this.type,targetId:this.targetId,channelId:r.channelId},{traceId:s}),[4,this._context.sendMessage(this.type,this.targetId,r,void 0,s)];case 1:return a=n.sent(),i=a.code,c=a.data,(i===e.ErrorCode.SUCCESS?e.logger.info:e.logger.warn)(e.LogTagId.A_SEND_MSG_R,{code:i,messageUId:c?c.messageUId:\"\",messageId:c?c.messageId:\"\"},{traceId:s}),i===e.ErrorCode.SUCCESS?[2,P(c)]:(w.warn(\"send typing status message fail ->\".concat(i,\":\").concat(b[i],\",\").concat(o)),[2,Promise.reject({code:i,msg:b[i]})])}}))}))},t.prototype.getMessageReader=function(t){return o(this,void 0,void 0,(function(){var o,r,s,a;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"messageUId\",t,e.AssertRules.STRING,!0),o=\"messageUId:\".concat(t,\",targetId:\").concat(this.targetId),w.debug(\"get message reader ->\".concat(o)),[4,this._context.getMessageReader(this.targetId,t)];case 1:return r=n.sent(),s=r.code,a=r.data,s===e.ErrorCode.SUCCESS?[2,Promise.resolve(a)]:(w.warn(\"get message reader fail ->\".concat(s,\":\").concat(b[s],\",\").concat(o)),[2,Promise.reject(s)])}}))}))},t.prototype.getInfo=function(){return o(this,void 0,void 0,(function(){var t,o,r;return n(this,(function(n){switch(n.label){case 0:return[4,this._context.getConversation(this.type,this.targetId,\"\")];case 1:return t=n.sent(),o=t.code,r=t.data,o===e.ErrorCode.SUCCESS&&r?[2,L(r)]:[2,Promise.reject({code:o,msg:b[o]})]}}))}))},t.prototype.removeTags=function(t){return o(this,void 0,void 0,(function(){var o;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"tagIds\",t,e.AssertRules.ARRAY,!0),t.forEach((function(t){e.assert(\"tagId\",t,e.AssertRules.STRING,!0)})),w.info(\"removeTags ->targetId:\".concat(this.targetId,\",type:\").concat(this.type)),[4,this._context.removeTagsForConversation({conversationType:this.type,targetId:this.targetId},t)];case 1:return(o=n.sent().code)===e.ErrorCode.SUCCESS?[2,o]:(w.warn(\"removeTags fail ->\".concat(o,\":\").concat(b[o])),[2,Promise.reject({code:o,msg:b[o]})])}}))}))},t.prototype.getTags=function(){return o(this,void 0,void 0,(function(){var t,o,r;return n(this,(function(n){switch(n.label){case 0:return w.info(\"getTags ->targetId:\".concat(this.targetId,\",type:\").concat(this.type)),[4,this._context.getTagsForConversation({conversationType:this.type,targetId:this.targetId})];case 1:return t=n.sent(),o=t.code,r=t.data,o===e.ErrorCode.SUCCESS?[2,r||[]]:(w.warn(\"getTags fail ->\".concat(o,\":\").concat(b[o])),[2,Promise.reject({code:o,msg:b[o]})])}}))}))},t}(),Y=function(){function t(e){this._context=e}return t.prototype.getList=function(t){return o(this,void 0,void 0,(function(){var o,r,s,a;return n(this,(function(n){switch(n.label){case 0:return w.debug(\"get conversation list ->\"),[4,this._context.getConversationList(null==t?void 0:t.count,void 0,null==t?void 0:t.startTime,null==t?void 0:t.order)];case 1:return o=n.sent(),r=o.code,s=o.data,r===e.ErrorCode.SUCCESS&&s?(a=s.map((function(e){return L(e)})),[2,D(a)]):(w.warn(\"get conversation list fail ->\".concat(r,\":\").concat(b[r])),[2,Promise.reject({code:r,msg:b[r]})])}}))}))},t.prototype.get=function(t){return e.assert(\"options.type\",t.type,e.isValidConversationType,!0),new W(this._context,t)},t.prototype.remove=function(t){return e.assert(\"options.type\",t.type,e.isValidConversationType,!0),new W(this._context,t).destory()},t.prototype.getTotalUnreadCount=function(t,r){return o(this,void 0,void 0,(function(){var o,s,a,i,c,u;return n(this,(function(n){switch(n.label){case 0:if(w.debug(\"get total unread count -> ConversationType:\".concat(JSON.stringify(r),\" includeMuted:\").concat(t)),e.assert(\"includeMuted\",t,e.AssertRules.BOOLEAN,!1),e.assert(\"conversationTypes\",r,e.AssertRules.ARRAY,!1),r)for(o=0,s=r;o<s.length;o++)a=s[o],e.assert(\"conversationType\",a,e.AssertRules.NUMBER);return[4,this._context.getTotalUnreadCount(\"\",r,t)];case 1:return i=n.sent(),c=i.code,u=i.data,c===e.ErrorCode.SUCCESS?[2,u]:(w.warn(\"getTotalUnreadCount fail ->\".concat(c,\":\").concat(b[c])),[2,Promise.reject({code:c,msg:b[c]})])}}))}))},t.prototype.readAll=function(){return o(this,void 0,void 0,(function(){return n(this,(function(e){return[2,this._context.clearAllUnreadCount()]}))}))},t.prototype.merge=function(t){return t.conversationList||w.warn(\"Parameter option.conversationList are required!\"),function(t){var o=(t=t||{}).conversationList,n=t.updatedConversationList;o=o||[];var s=r(r([],n=n||[],!0),o,!0),a={},i=[],c=[];return e.forEach(s,(function(t){if(e.isObject(t)){var o=t.type,n=t.targetId,r=B({type:o,targetId:n}),s=a[r]||{},u=e.isUndefined(s.index)?i.length:s.index,d=s.val||{},g=d.updatedItems||{},p=t.updatedItems;t=F(t,d),e.forEach(g,(function(e,o){t[o]=e.val})),e.forEach(p,(function(e,o){var n=(g[o]||{}).time||0;e.time>n&&(t[o]=e.val)})),a[r]={index:u,val:t},i[u]=t,V(t)&&c.push(u)}})),e.forEach(c,(function(e){var t=i[e];i[e]=K(t)})),i=D(i),e.map(i,(function(e){return delete e.updatedItems,e}))}(t)},t}(),X=function(){function t(e,t){this._context=e,this.tagId=t}return t.prototype.update=function(t){return o(this,void 0,void 0,(function(){var o;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"tagName\",t,e.AssertRules.STRING,!0),e.assert(\"tagName\",t,(function(e){return e.length<=15})),w.info(\"update ->tagId:\".concat(this.tagId,\",tagName:\").concat(t)),[4,this._context.updateTag({tagId:this.tagId,tagName:t})];case 1:return(o=n.sent().code)===e.ErrorCode.SUCCESS?[2,o]:(w.warn(\"update ->code:\".concat(o,\",tagId:\").concat(this.tagId)),[2,Promise.reject({code:o,msg:b[o]})])}}))}))},t.prototype.remove=function(){return o(this,void 0,void 0,(function(){var t;return n(this,(function(o){switch(o.label){case 0:return w.info(\"remove ->tagId:\".concat(this.tagId)),[4,this._context.removeTag(this.tagId)];case 1:return(t=o.sent().code)===e.ErrorCode.SUCCESS?[2,t]:(w.warn(\"remove ->code:\".concat(t,\",tagId:\").concat(this.tagId)),[2,Promise.reject({code:t,msg:b[t]})])}}))}))},t.prototype.addConversations=function(t){return o(this,void 0,void 0,(function(){var o;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"conversations\",t,e.AssertRules.ARRAY,!0),t.forEach((function(t){e.assert(\"conversation.type\",t.type,e.AssertRules.NUMBER,!0),e.assert(\"conversation.targetId\",t.targetId,e.AssertRules.STRING,!0)})),w.info(\"addConversations ->tagId:\".concat(this.tagId)),[4,this._context.addTagForConversations(this.tagId,t.map((function(e){return q(e)})))];case 1:return(o=n.sent().code)===e.ErrorCode.SUCCESS?[2,o]:(w.warn(\"addConversations ->code:\".concat(o,\",tagId:\").concat(this.tagId)),[2,Promise.reject({code:o,msg:b[o]})])}}))}))},t.prototype.removeConversations=function(t){return o(this,void 0,void 0,(function(){var o;return n(this,(function(n){switch(n.label){case 0:return w.info(\"removeConversations ->tagId:\".concat(this.tagId)),[4,this._context.removeTagForConversations(this.tagId,t.map((function(e){return q(e)})))];case 1:return(o=n.sent().code)===e.ErrorCode.SUCCESS?[2,o]:(w.warn(\"removeConversations ->code:\".concat(o,\",tagId:\").concat(this.tagId)),[2,Promise.reject({code:o,msg:b[o]})])}}))}))},t.prototype.getConversationList=function(t,r){return o(this,void 0,void 0,(function(){var o,s,a,i;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"count\",r,e.AssertRules.NUMBER,!0),e.assert(\"startTime\",t,e.AssertRules.NUMBER,!0),w.info(\"getConversationList ->tagId:\".concat(this.tagId)),[4,this._context.getConversationListByTag(this.tagId,t,r)];case 1:return o=n.sent(),s=o.data,a=o.code,i=[],a===e.ErrorCode.SUCCESS?((s=s||[]).forEach((function(e){var t=e.channelId,o=e.conversationType,n=e.targetId,r=e.unreadMessageCount,s=e.latestMessage,a=e.hasMentioned,c=e.mentionedInfo,u=e.notificationStatus,d=e.isTop,g=e.lastUnreadTime,p=e.isTopInTag;i.push({channelId:t,conversationType:o,targetId:n,unreadMessageCount:r,latestMessage:s,hasMentioned:a,mentionedInfo:c,notificationStatus:u,isTop:d,lastUnreadTime:g,isTopInTag:p})})),[2,i]):(w.warn(\"getConversationList ->code:\".concat(a,\",tagId:\").concat(this.tagId)),[2,Promise.reject({code:a,msg:b[a]})])}}))}))},t.prototype.getUnreadCount=function(t){return o(this,void 0,void 0,(function(){var o,r,s;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"isIncludeNotNotification\",t,e.AssertRules.BOOLEAN,!0),w.info(\"getUnreadCount ->tagId:\".concat(this.tagId)),[4,this._context.getUnreadCountByTag(this.tagId,t)];case 1:return o=n.sent(),r=o.data,(s=o.code)===e.ErrorCode.SUCCESS?[2,r||0]:(w.warn(\"getUnreadCount ->code:\".concat(s,\",tagId:\").concat(this.tagId)),[2,Promise.reject({code:s,msg:b[s]})])}}))}))},t.prototype.updateConversationIsTop=function(t,r){return o(this,void 0,void 0,(function(){var o;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"conversation.targetId\",t.targetId,e.AssertRules.STRING,!0),e.assert(\"conversation.type\",t.type,e.AssertRules.NUMBER,!0),e.assert(\"isTop\",r,e.AssertRules.BOOLEAN,!0),w.info(\"updateConversationIsTop ->tagId:\".concat(this.tagId)),[4,this._context.setConversationStatusInTag(this.tagId,q(t),{isTop:r})];case 1:return(o=n.sent().code)===e.ErrorCode.SUCCESS?[2,o]:(w.warn(\"updateConversationIsTop ->code:\".concat(o,\",tagId:\").concat(this.tagId)),[2,Promise.reject({code:o,msg:b[o]})])}}))}))},t}(),J=function(){function t(e){this._context=e}return t.prototype.create=function(t){return o(this,void 0,void 0,(function(){var o;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"tag.tagId\",t.tagId,e.AssertRules.STRING,!0),e.assert(\"tag.tagId\",t.tagId,(function(e){return e.length<=10})),e.assert(\"tag.tagName\",t.tagName,(function(e){return e.length<=15})),e.assert(\"tag.tagName\",t.tagName,e.AssertRules.STRING,!0),w.info(\"create tag->tagId:\".concat(t.tagId,\",tagName:\").concat(t.tagName)),[4,this._context.createTag(t)];case 1:return(o=n.sent().code)===e.ErrorCode.SUCCESS?[2,o]:(w.warn(\"create tag fail ->\".concat(o,\":\").concat(b[o])),[2,Promise.reject({code:o,msg:b[o]})])}}))}))},t.prototype.getTagInfoList=function(){return o(this,void 0,void 0,(function(){var t,o,r;return n(this,(function(n){switch(n.label){case 0:return[4,this._context.getTagList()];case 1:return t=n.sent(),o=t.code,r=t.data,o===e.ErrorCode.SUCCESS?[2,r||[]]:(w.warn(\"getTagInfoList ->code:\".concat(o)),[2,Promise.reject({code:o,msg:b[o]})])}}))}))},t.prototype.get=function(t){return o(this,void 0,void 0,(function(){return n(this,(function(o){return e.assert(\"tag.tagId\",t,e.AssertRules.STRING,!0),e.assert(\"tag.tagId\",t,(function(e){return e.length<=10})),[2,new X(this._context,t)]}))}))},t}(),Q=function(t){e.assert(\"options.key\",t.key,e.AssertRules.STRING,!0),e.assert(\"options.value\",t.value,e.AssertRules.STRING,!0),e.assert(\"options.isAutoDelete\",t.isAutoDelete,e.AssertRules.BOOLEAN),e.assert(\"options.isSendNotification\",t.isSendNotification,e.AssertRules.BOOLEAN),e.assert(\"options.notificationExtra\",t.notificationExtra,e.AssertRules.STRING)},z=function(t){e.assert(\"options.key\",t.key,e.AssertRules.STRING,!0),e.assert(\"options.isSendNotification\",t.isSendNotification,e.AssertRules.BOOLEAN),e.assert(\"options.notificationExtra\",t.notificationExtra,e.AssertRules.STRING)},Z=function(){function r(e,t){this._context=e,this._id=t}return r.prototype.join=function(t){return o(this,void 0,void 0,(function(){var o,r,s;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"options.count\",t.count,e.AssertRules.NUMBER,!0),o=\"id:\".concat(this._id),w.debug(\"join chatroom ->\".concat(o)),r=e.logger.ID(),e.logger.info(e.LogTagId.A_JOIN_CHATROOM_T,{chatroomId:this._id,count:t.count,joinExist:!1},{traceId:r}),[4,this._context.joinChatroom(this._id,t.count,r)];case 1:return s=n.sent(),(s===e.ErrorCode.SUCCESS?e.logger.info:e.logger.warn)(e.LogTagId.A_JOIN_CHATROOM_R,{code:s,timestamp:(new Date).getTime()},{traceId:r}),s!==e.ErrorCode.SUCCESS?(w.warn(\"join chatroom fail ->code+:\".concat(b[s],\",\").concat(o)),[2,Promise.reject({code:s,msg:b[s]})]):[2]}}))}))},r.prototype.joinExist=function(t){return o(this,void 0,void 0,(function(){var o,r,s;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"options.count\",t.count,e.AssertRules.NUMBER,!0),o=\"id:\".concat(this._id),w.debug(\"join exist chatroom ->\".concat(o)),r=e.logger.ID(),e.logger.info(e.LogTagId.A_JOIN_CHATROOM_T,{chatroomId:this._id,count:t.count,joinExist:!0},{traceId:r}),[4,this._context.joinExistChatroom(this._id,t.count,r)];case 1:return s=n.sent(),(s===e.ErrorCode.SUCCESS?e.logger.info:e.logger.warn)(e.LogTagId.A_JOIN_CHATROOM_R,{code:s,timestamp:(new Date).getTime()},{traceId:r}),s!==e.ErrorCode.SUCCESS?(w.warn(\"join exist chatroom fail ->code:\".concat(b[s],\",\").concat(o)),[2,Promise.reject({code:s,msg:b[s]})]):[2]}}))}))},r.prototype.quit=function(){return o(this,void 0,void 0,(function(){var t,o,r;return n(this,(function(n){switch(n.label){case 0:return t=\"id:\".concat(this._id),w.debug(\"quit chatroom ->\".concat(t)),o=e.logger.ID(),e.logger.info(e.LogTagId.A_QUIT_CHATROOM_T,{chatroomId:this._id},{traceId:o}),[4,this._context.quitChatroom(this._id)];case 1:return r=n.sent(),(r===e.ErrorCode.SUCCESS?e.logger.info:e.logger.warn)(e.LogTagId.A_QUIT_CHATROOM_R,{code:r},{traceId:o}),r!==e.ErrorCode.SUCCESS?(w.warn(\"quit chatroom fail ->code+:\".concat(b[r],\",\").concat(t)),[2,Promise.reject({code:r,msg:b[r]})]):[2]}}))}))},r.prototype.getInfo=function(t){return void 0===t&&(t={}),o(this,void 0,void 0,(function(){var o,r,s,a;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"options.count\",t.count,e.AssertRules.NUMBER),e.assert(\"options.order\",t.order,(function(e){return[0,1,2].includes(e)})),o=\"id:\".concat(this._id),w.debug(\"get chatroom info ->\".concat(o)),[4,this._context.getChatroomInfo(this._id,t.count,t.order)];case 1:return r=n.sent(),s=r.code,a=r.data,s===e.ErrorCode.SUCCESS&&a?[2,a]:(w.warn(\"get chatroom info fail ->code+:\".concat(b[s],\",\").concat(o)),[2,Promise.reject({code:s,msg:b[s]})])}}))}))},r.prototype.setEntry=function(t){return o(this,void 0,void 0,(function(){var o,r;return n(this,(function(n){switch(n.label){case 0:return Q(t),o=\"id:\".concat(this._id),w.debug(\"set chatroom entry->\".concat(o)),[4,this._context.setChatroomEntry(this._id,t)];case 1:return(r=n.sent())!==e.ErrorCode.SUCCESS?(w.warn(\"set chatroom entry fail ->code+:\".concat(b[r],\",\").concat(o)),[2,Promise.reject({code:r,msg:b[r]})]):[2]}}))}))},r.prototype.setEntries=function(t){return o(this,void 0,void 0,(function(){var o,r,s,a;return n(this,(function(n){switch(n.label){case 0:return function(t){t.entries.forEach((function(t){e.assert(\"entry.key\",t.key,e.AssertRules.STRING,!0),e.assert(\"entry.value\",t.value,e.AssertRules.STRING,!0)})),e.assert(\"options.isAutoDelete\",t.isAutoDelete,e.AssertRules.BOOLEAN),e.assert(\"options.notificationExtra\",t.notificationExtra,e.AssertRules.STRING)}(t),t.entries.length>10?[2,Promise.reject(M.CHATROOM_KV_STORE_OUT_LIMIT)]:(o=\"id:\".concat(this._id),w.debug(\"set chatroom entry->\".concat(o)),[4,this._context.setChatroomEntries(this._id,t)]);case 1:return r=n.sent(),s=r.code,a=r.data,s!==e.ErrorCode.SUCCESS?(w.warn(\"set chatroom entry fail ->code+:\".concat(b[s],\",\").concat(o)),[2,Promise.reject({code:s,msg:b[s],data:a})]):[2]}}))}))},r.prototype.forceSetEntry=function(t){return o(this,void 0,void 0,(function(){var o,r;return n(this,(function(n){switch(n.label){case 0:return Q(t),o=\"id:\".concat(this._id),w.debug(\"force set chatroom entry ->\".concat(o)),[4,this._context.forceSetChatroomEntry(this._id,t)];case 1:return(r=n.sent())!==e.ErrorCode.SUCCESS?(w.warn(\"force set chatroom entry fail ->code+:\".concat(b[r],\",\").concat(o)),[2,Promise.reject({code:r,msg:b[r]})]):[2]}}))}))},r.prototype.removeEntry=function(t){return o(this,void 0,void 0,(function(){var o,r;return n(this,(function(n){switch(n.label){case 0:return z(t),o=\"id:\".concat(this._id),w.debug(\"remove chatroom entry->\".concat(o)),[4,this._context.removeChatroomEntry(this._id,t)];case 1:return(r=n.sent())!==e.ErrorCode.SUCCESS?(w.warn(\"remove chatroom entry fail ->code+:\".concat(b[r],\",\").concat(o)),[2,Promise.reject({code:r,msg:b[r]})]):[2]}}))}))},r.prototype.removeEntries=function(r){return o(this,void 0,void 0,(function(){var o,s,a,i,c;return n(this,(function(n){switch(n.label){case 0:return function(t){t.entries.forEach((function(t){e.assert(\"key\",t,e.AssertRules.STRING,!0)}))}(r),o=\"id:\".concat(this._id),w.debug(\"remove chatroom entry->\".concat(o)),(s=t({},r)).entries=r.entries.map((function(e){return{key:e}})),[4,this._context.removeChatroomEntries(this._id,s)];case 1:return a=n.sent(),i=a.code,c=a.data,i!==e.ErrorCode.SUCCESS?(w.warn(\"remove chatroom entry fail ->code+:\".concat(b[i],\",\").concat(o)),[2,Promise.reject({code:i,msg:b[i],data:c})]):[2]}}))}))},r.prototype.forceRemoveEntry=function(t){return o(this,void 0,void 0,(function(){var o,r;return n(this,(function(n){switch(n.label){case 0:return z(t),o=\"id:\".concat(this._id),w.debug(\"force remove chatroom entry ->\".concat(o)),[4,this._context.forceRemoveChatroomEntry(this._id,t)];case 1:return(r=n.sent())!==e.ErrorCode.SUCCESS?(w.warn(\"force remove chatroom entry fail ->code+:\".concat(b[r],\",\").concat(o)),[2,Promise.reject({code:r,msg:b[r]})]):[2]}}))}))},r.prototype.getEntry=function(t){return o(this,void 0,void 0,(function(){var o,r,s,a;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"key\",t,(function(t){return e.isString(t)&&/[\\w+=-]+/.test(t)&&t.length<=128}),!0),o=\"id:\".concat(this._id),w.debug(\"get chatroom entry->\".concat(o)),[4,this._context.getChatroomEntry(this._id,t)];case 1:return r=n.sent(),s=r.code,a=r.data,s===e.ErrorCode.SUCCESS&&a?[2,a]:(w.warn(\"get chatroom entry fail ->code+:\".concat(b[s],\",\").concat(o)),[2,Promise.reject({code:s,msg:b[s]})])}}))}))},r.prototype.getAllEntries=function(){return o(this,void 0,void 0,(function(){var t,o,r,s;return n(this,(function(n){switch(n.label){case 0:return t=\"id:\".concat(this._id),w.debug(\"get all chatroom entries->\".concat(t)),[4,this._context.getAllChatroomEntries(this._id)];case 1:return o=n.sent(),r=o.code,s=o.data,r===e.ErrorCode.SUCCESS&&s?[2,s]:(w.warn(\"get all chatroom entries fail ->code+:\".concat(b[r],\",\").concat(t)),[2,Promise.reject({code:r,msg:b[r]})])}}))}))},r.prototype.send=function(t){return o(this,void 0,void 0,(function(){var o,r,s,a,i;return n(this,(function(n){switch(n.label){case 0:return k(t),o=\"id:\".concat(this._id),w.debug(\"send chatroom message ->\".concat(o)),Object.prototype.hasOwnProperty.call(t,\"isPersited\")||(t.isPersited=!0),Object.prototype.hasOwnProperty.call(t,\"isCounted\")||(t.isCounted=!0),r=e.logger.ID(),e.logger.info(e.LogTagId.A_SEND_MSG_T,{messageType:t.messageType,conversationType:e.ConversationType.CHATROOM,channelId:t.channelId},{traceId:r}),[4,this._context.sendMessage(e.ConversationType.CHATROOM,this._id,t,void 0,r)];case 1:return s=n.sent(),a=s.code,i=s.data,(a===e.ErrorCode.SUCCESS?e.logger.info:e.logger.warn)(e.LogTagId.A_SEND_MSG_R,{code:a,messageUId:i?i.messageUId:\"\",messageId:i?i.messageId:\"\"},{traceId:r}),a===e.ErrorCode.SUCCESS?[2,P(i)]:(w.warn(\"send chatroom message fail ->code+:\".concat(b[a],\",\").concat(o)),[2,Promise.reject({code:a,msg:b[a]})])}}))}))},r.prototype.getMessages=function(t){return o(this,void 0,void 0,(function(){var o,r,s,a;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"options.timestamp\",t.timestamp,e.AssertRules.NUMBER),e.assert(\"options.count\",t.count,e.AssertRules.NUMBER),e.assert(\"options.order\",t.order,(function(e){return 0===e||1===e})),o=\"id:\".concat(this._id),w.debug(\"get chatroom history message->\".concat(o)),[4,this._context.getChatRoomHistoryMessages(this._id,t.count,t.order,t.timestamp)];case 1:return r=n.sent(),s=r.code,a=r.data,s===e.ErrorCode.SUCCESS&&a?[2,{list:a.list.map((function(e){return P(e)})),hasMore:a.hasMore}]:(w.warn(\"get chatroom history message fail ->code+:\".concat(b[s],\",\").concat(o)),[2,Promise.reject({code:s,msg:b[s]})])}}))}))},r.prototype.recall=function(t){return o(this,void 0,void 0,(function(){var o,r,s,a,i;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"options.messageUId\",t.messageUId,e.AssertRules.STRING,!0),e.assert(\"options.sentTime\",t.sentTime,e.AssertRules.NUMBER,!0),o=\"id:\".concat(this._id,\",messageUId:\").concat(t.messageUId),w.debug(\"chatroom recall->\".concat(o)),r=e.ConversationType.CHATROOM,[4,this._context.recallMessage(r,this._id,t.messageUId,t.sentTime,{channelId:\"\",user:t.user})];case 1:return s=n.sent(),a=s.code,i=s.data,a===e.ErrorCode.SUCCESS&&i?[2,P(i)]:(w.warn(\"chatroom recall fail->code+:\".concat(b[a],\",\").concat(o)),[2,Promise.reject({code:a,msg:b[a]})])}}))}))},r}(),$=function(){function t(e){this._context=e}return t.prototype.get=function(t){return e.assert(\"option.id\",t.id,e.notEmptyString,!0),new Z(this._context,t.id)},t}(),ee=function(){function r(e,t){this._options=e,this._context=t,this._roomId=e.id}return r.prototype.join=function(){return o(this,void 0,void 0,(function(){var t,o,r,s;return n(this,(function(n){switch(n.label){case 0:return t=\"roomId:\".concat(this._roomId),w.debug(\"join ->\".concat(t)),[4,this._context.joinRTCRoom(this._roomId,this._options.mode,this._options.broadcastType)];case 1:return o=n.sent(),r=o.code,s=o.data,r===e.ErrorCode.SUCCESS?[2,s]:(w.warn(\"join fail ->\".concat(r,\":\").concat(b[r],\",\").concat(t)),[2,Promise.reject(r)])}}))}))},r.prototype.quit=function(){return o(this,void 0,void 0,(function(){var t,o;return n(this,(function(n){switch(n.label){case 0:return t=\"roomId:\".concat(this._roomId),w.debug(\"quit ->\".concat(t)),[4,this._context.quitRTCRoom(this._roomId)];case 1:return(o=n.sent())===e.ErrorCode.SUCCESS?[2,o]:(w.warn(\"quit fail ->\".concat(o,\":\").concat(b[o],\",\").concat(t)),[2,Promise.reject(o)])}}))}))},r.prototype.getRoomInfo=function(){return o(this,void 0,void 0,(function(){var t,o,r,s;return n(this,(function(n){switch(n.label){case 0:return t=\"roomId:\".concat(this._roomId),w.debug(\"get roomInfo ->\".concat(t)),[4,this._context.getRTCRoomInfo(this._roomId)];case 1:return o=n.sent(),r=o.code,s=o.data,r===e.ErrorCode.SUCCESS?[2,s]:(w.warn(\"get roomInfo fail ->\".concat(r,\":\").concat(b[r],\",\").concat(t)),[2,Promise.reject(r)])}}))}))},r.prototype.setUserInfo=function(t){return o(this,void 0,void 0,(function(){var o,r;return n(this,(function(n){switch(n.label){case 0:return o=\"roomId:\".concat(this._roomId,\",key:\").concat(t.key,\",value:\").concat(t.value),w.debug(\"set userInfo ->\".concat(o)),[4,this._context.setRTCUserInfo(this._roomId,t.key,t.value)];case 1:return(r=n.sent())===e.ErrorCode.SUCCESS?[2,r]:(w.warn(\"set userInfo fail ->\".concat(r,\":\").concat(b[r],\",\").concat(o)),[2,Promise.reject(r)])}}))}))},r.prototype.removeUserInfo=function(t){return o(this,void 0,void 0,(function(){var o,r;return n(this,(function(n){switch(n.label){case 0:return o=\"roomId:\".concat(this._roomId,\",keys:\").concat((t.keys||[]).join(\",\")),w.debug(\"remove useerInfo ->\".concat(o)),[4,this._context.removeRTCUserInfo(this._roomId,t.keys)];case 1:return(r=n.sent())===e.ErrorCode.SUCCESS?[2,r]:(w.warn(\"remove userInfo fail ->\".concat(r,\":\").concat(b[r],\",\").concat(o)),[2,Promise.reject(r)])}}))}))},r.prototype.setData=function(t,r,s,a,i){return o(this,void 0,void 0,(function(){var o,c;return n(this,(function(n){switch(n.label){case 0:return o=\"roomId:\".concat(this._roomId,\",key:\").concat(t,\",value:\").concat(r),w.debug(\"set data ->\".concat(o)),[4,this._context.setRTCData(this._roomId,t,r,s,a,i)];case 1:return(c=n.sent())===e.ErrorCode.SUCCESS?[2,c]:(w.warn(\"set data fail ->\".concat(c,\":\").concat(b[c],\",\").concat(o)),[2,Promise.reject(c)])}}))}))},r.prototype.setUserData=function(t,o,n,r){return this.setData(t,o,n,e.RTCApiType.PERSON,r)},r.prototype.setRTCUserData=function(t,r,s){return o(this,void 0,void 0,(function(){var o,a;return n(this,(function(n){switch(n.label){case 0:return o=\"roomId:\".concat(this._roomId),w.debug(\"set rtc user ->\".concat(o)),[4,this._context.setRTCTotalRes(this._roomId,t,r,s)];case 1:return(a=n.sent())===e.ErrorCode.SUCCESS?[2,a]:(w.warn(\"set rtc user fail ->\".concat(a,\":\").concat(b[a],\",\").concat(o)),[2,Promise.reject(a)])}}))}))},r.prototype.getData=function(t,r,s){return o(this,void 0,void 0,(function(){var o,a,i,c;return n(this,(function(n){switch(n.label){case 0:return o=\"roomId:\".concat(this._roomId),w.debug(\"get data ->\".concat(o)),[4,this._context.getRTCData(this._roomId,t,r,s)];case 1:return a=n.sent(),i=a.code,c=a.data,i===e.ErrorCode.SUCCESS?[2,c]:(w.warn(\"get data fail ->\".concat(i,\":\").concat(b[i],\",\").concat(o)),[2,Promise.reject(i)])}}))}))},r.prototype.getUserData=function(t,o){return this.getData(t,o,e.RTCApiType.PERSON)},r.prototype.removeData=function(t,r,s,a){return o(this,void 0,void 0,(function(){var o,i;return n(this,(function(n){switch(n.label){case 0:return o=\"roomId:\".concat(this._roomId,\",keys:\").concat(t.join(\",\")),w.debug(\"remove data ->\".concat(o)),[4,this._context.removeRTCData(this._roomId,t,r,s,a)];case 1:return(i=n.sent())===e.ErrorCode.SUCCESS?[2,i]:(w.warn(\"remove data fail ->\".concat(i,\":\").concat(b[i],\",\").concat(o)),[2,Promise.reject(i)])}}))}))},r.prototype.removeUserData=function(t,o,n){return this.removeData(t,o,e.RTCApiType.PERSON,n)},r.prototype.setRoomData=function(t,o,n,r){return this.setData(t,o,n,e.RTCApiType.ROOM,r)},r.prototype.getRoomData=function(t,o){return this.getData(t,o,e.RTCApiType.ROOM)},r.prototype.removeRoomData=function(t,o,n){return this.removeData(t,o,e.RTCApiType.ROOM,n)},r.prototype.setState=function(t){return o(this,void 0,void 0,(function(){var o,r;return n(this,(function(n){switch(n.label){case 0:return o=\"roomId:\".concat(this._roomId),w.debug(\"set state ->\".concat(o)),[4,this._context.setRTCState(this._roomId,t.report)];case 1:return(r=n.sent())===e.ErrorCode.SUCCESS?[2,r]:(w.warn(\"set state fail ->\".concat(r,\":\").concat(b[r],\",\").concat(o)),[2,Promise.reject(r)])}}))}))},r.prototype.getUserList=function(){return o(this,void 0,void 0,(function(){var t,o,r,s;return n(this,(function(n){switch(n.label){case 0:return t=\"roomId:\".concat(this._roomId),w.debug(\"get userList ->\".concat(t)),[4,this._context.getRTCUserInfoList(this._roomId)];case 1:return o=n.sent(),r=o.code,s=o.data,r===e.ErrorCode.SUCCESS?[2,s]:(w.warn(\"get userList fail ->\".concat(r,\":\").concat(b[r],\",\").concat(t)),[2,Promise.reject(r)])}}))}))},r.prototype.getUserInfoList=function(){return o(this,void 0,void 0,(function(){var t,o,r,s;return n(this,(function(n){switch(n.label){case 0:return t=\"roomId:\".concat(this._roomId),w.debug(\"get userInfo list ->\".concat(t)),[4,this._context.getRTCUserInfoList(this._roomId)];case 1:return o=n.sent(),r=o.code,s=o.data,r===e.ErrorCode.SUCCESS?[2,null==s?void 0:s.users]:(w.warn(\"get userInfo list fail ->\".concat(r,\":\").concat(b[r],\",\").concat(t)),[2,Promise.reject(r)])}}))}))},r.prototype.getToken=function(){return o(this,void 0,void 0,(function(){var t,o,r,s;return n(this,(function(n){switch(n.label){case 0:return t=\"roomId:\".concat(this._roomId),w.debug(\"getToken ->\".concat(t)),[4,this._context.getRTCToken(this._roomId,this._options.mode,this._options.broadcastType)];case 1:return o=n.sent(),r=o.data,(s=o.code)===e.ErrorCode.SUCCESS?[2,r]:(w.warn(\"getToken fail ->\".concat(s,\":\").concat(b[s],\",\").concat(t)),[2,Promise.reject(s)])}}))}))},r.prototype.ping=function(){return o(this,void 0,void 0,(function(){var t,o;return n(this,(function(n){switch(n.label){case 0:return t=\"roomId:\".concat(this._roomId),w.debug(\"ping ->\".concat(t)),[4,this._context.rtcPing(this._roomId,this._options.mode,this._options.broadcastType)];case 1:return(o=n.sent())===e.ErrorCode.SUCCESS?[2,o]:(w.warn(\"ping fail ->\".concat(o,\":\").concat(b[o],\",\").concat(t)),[2,Promise.reject(o)])}}))}))},r.prototype.send=function(r){return o(this,void 0,void 0,(function(){var o,s,a,i;return n(this,(function(n){switch(n.label){case 0:return o=\"roomId:\".concat(this._roomId),w.debug(\"send ->\".concat(o)),[4,this._context.sendMessage(e.ConversationType.RTC_ROOM,this._roomId,{content:t({},r.content),messageType:r.messageType})];case 1:return s=n.sent(),a=s.code,i=s.data,a===e.ErrorCode.SUCCESS?[2,i]:(w.warn(\"send fail ->\".concat(a,\":\").concat(b[a],\",\").concat(o)),[2,Promise.reject(a)])}}))}))},r}();e.VersionManage.add(\"imlib-v4-adapter\",\"5.5.1\");var te,oe=[],ne=[],re={message:function(e){oe.forEach((function(t){return t(e)}))},status:function(e){ne.forEach((function(t){return t(e)}))}},se=function(){function t(t){this._token=\"\",this._context=t,this.Conversation=new Y(t),this.ChatRoom=new $(t),this.Tag=new J(t),this.RTC=function(o){return e.assert(\"options.id\",o.id,e.notEmptyString,!0),new ee(o,t)}}return t.prototype.install=function(e,t){return this._context.install(e,t)},t.prototype.watch=function(t){var o=t.status,n=t.conversation,r=t.message,s=t.chatroom,a=t.expansion,i=t.typingStatus,c=t.pullFinished,u=t.messageBlocked,d=t.tag,g={};if(o){var p=e.logger.ID();g.connectionState=function(t){try{e.logger.info(e.LogTagId.A_CONNECT_S,{status:t},{traceId:p}),o({status:t})}catch(e){w.error(e)}}}n&&(g.conversationState=function(e){try{var t=e.map((function(e){return o=(t=e).updatedItems,n=t.conversationType,r=t.targetId,s=t.latestMessage,a=t.unreadMessageCount,i=t.lastUnreadTime,c=t.notificationStatus,u=t.isTop,d=t.mentionedInfo,g=t.hasMentioned,p=s&&P(s),o&&o.latestMessage&&(o.latestMessage.val=p),{updatedItems:o,type:n,targetId:r,latestMessage:p,unreadMessageCount:a,lastUnreadTime:i,notificationStatus:c,isTop:u,mentionedInfo:d,hasMentioned:g};var t,o,n,r,s,a,i,c,u,d,g,p}));n({updatedConversationList:t})}catch(e){w.error(e)}}),r&&(g.message=function(t){try{var o=P(t);e.logger.info(e.LogTagId.A_PULL_MSG_O,{message:o.messageUId}),r({message:o})}catch(e){w.error(e)}}),s&&(g.chatroomState=function(e){try{s(e)}catch(e){w.error(e)}}),a&&(g.expansion=function(e){try{a(e)}catch(e){w.error(e)}}),c&&(g.pullFinished=function(){try{c()}catch(e){w.error(e)}}),i&&(g.typingState=function(e){try{i(e)}catch(e){w.error(e)}}),u&&(g.messageBlocked=function(e){try{u(e)}catch(e){w.error(e)}}),d&&(g.tag=function(){try{d()}catch(e){w.error(e)}}),this._context.assignWatcher(g)},t.prototype.unwatch=function(){this._context.assignWatcher({message:void 0,connectionState:void 0,conversationState:void 0,chatroomState:void 0,expansion:void 0,pullFinished:void 0,typingState:void 0,messageBlocked:void 0})},t.prototype.rtcInnerWatch=function(e){var t=e.message,o=e.status;t&&oe.push((function(e){try{t({message:P(e)})}catch(e){w.error(e)}})),o&&ne.push((function(e){try{o({status:e})}catch(e){w.error(e)}})),this._context.assignWatcher({rtcInnerWatcher:re})},t.prototype.rtcInnerUnwatch=function(){ne.length=ne.length=0,this._context.assignWatcher({rtcInnerWatcher:void 0})},t.prototype.connect=function(t){return o(this,void 0,void 0,(function(){var o,r,s;return n(this,(function(n){switch(n.label){case 0:return e.assert(\"options.token\",t.token,e.AssertRules.STRING,!0),o=t.token,this._token=o,r=e.logger.ID(),e.logger.info(e.LogTagId.A_CONNECT_T,{token:o,reconnectKickEnable:!1},{traceId:r}),[4,this._context.connect(o,!1,!1,r)];case 1:return s=n.sent(),(s.code===e.ErrorCode.SUCCESS?e.logger.info:e.logger.warn)(e.LogTagId.A_CONNECT_R,{code:s.code,userId:s.userId},{traceId:r}),s.code===e.ErrorCode.SUCCESS?[2,{id:s.userId}]:[2,Promise.reject({code:s.code,msg:b[s.code]})]}}))}))},t.prototype.reconnect=function(){return o(this,void 0,void 0,(function(){var t;return n(this,(function(o){switch(o.label){case 0:return[4,this._context.reconnect()];case 1:return(t=o.sent()).code===e.ErrorCode.SUCCESS?[2,{id:t.userId}]:[2,Promise.reject({code:t.code,msg:b[t.code]})]}}))}))},t.prototype.disconnect=function(){return e.logger.info(e.LogTagId.A_DISCONNECT_O,{}),this._context.disconnect()},t.prototype.getAppInfo=function(){return{appkey:this._context.appkey,token:this._token,navi:this._context.getInfoFromCache()}},t.prototype.getConnectedTime=function(){return this._context.getConnectedTime()},t.prototype.getServerTime=function(){return this._context.getServerTime()},t.prototype.getConnectionStatus=function(){return this._context.getConnectionStatus()},t.prototype.getConnectionUserId=function(){return this._context.getCurrentUserId()},t.prototype.getFileToken=function(t,o,n,r){return e.assert(\"fileType\",t,e.isValidFileType,!0),this._context.getFileToken(t,o,n,r)},t.prototype.getFileUrl=function(t,o,n,r,s){return e.assert(\"fileType\",t,e.isValidFileType,!0),e.assert(\"filename\",o,e.AssertRules.STRING),e.assert(\"saveName\",n,e.AssertRules.STRING),e.assert(\"serverType\",s,e.AssertRules.NUMBER),this._context.getFileUrl(t,o,n,r,s)},t.prototype.changeUser=function(t){return o(this,void 0,void 0,(function(){return n(this,(function(o){switch(o.label){case 0:return w.warn(\"Method is deprecated\"),e.assert(\"options.token\",t.token,e.AssertRules.STRING,!0),[4,this.disconnect()];case 1:return o.sent(),[2,this.connect(t)]}}))}))},t.prototype.registerMessageType=function(e,t,o,n){this._context.registerMessageType(e,t,o,n)},t}(),ae=e.MessageDirection,ie=e.ConversationType,ce=e.FileType,ue={DO_NOT_DISTURB:e.NotificationStatus.OPEN,NOTIFY:e.NotificationStatus.CLOSE},de=e.ChatroomEntryType;Object.defineProperty(exports,\"ChatroomEntryType\",{enumerable:!0,get:function(){return e.ChatroomEntryType}}),Object.defineProperty(exports,\"ChatroomUserChangeType\",{enumerable:!0,get:function(){return e.ChatroomUserChangeType}}),Object.defineProperty(exports,\"ConnectionStatus\",{enumerable:!0,get:function(){return e.ConnectionStatus}}),Object.defineProperty(exports,\"ConversationType\",{enumerable:!0,get:function(){return e.ConversationType}}),Object.defineProperty(exports,\"ErrorCode\",{enumerable:!0,get:function(){return e.ErrorCode}}),Object.defineProperty(exports,\"FileType\",{enumerable:!0,get:function(){return e.FileType}}),Object.defineProperty(exports,\"LogLevel\",{enumerable:!0,get:function(){return e.LogLevel}}),Object.defineProperty(exports,\"LogSource\",{enumerable:!0,get:function(){return e.LogSource}}),Object.defineProperty(exports,\"LogTagId\",{enumerable:!0,get:function(){return e.LogTagId}}),Object.defineProperty(exports,\"MessageBlockType\",{enumerable:!0,get:function(){return e.MessageBlockType}}),Object.defineProperty(exports,\"MessageDirection\",{enumerable:!0,get:function(){return e.MessageDirection}}),Object.defineProperty(exports,\"NotificationStatus\",{enumerable:!0,get:function(){return e.NotificationStatus}}),Object.defineProperty(exports,\"RTCApiType\",{enumerable:!0,get:function(){return e.RTCApiType}}),Object.defineProperty(exports,\"RTCMode\",{enumerable:!0,get:function(){return e.RTCMode}}),Object.defineProperty(exports,\"UploadMethod\",{enumerable:!0,get:function(){return e.UploadMethod}}),Object.defineProperty(exports,\"logger\",{enumerable:!0,get:function(){return e.logger}}),exports.CHATROOM_ENTRY_TYPE=de,exports.CHATROOM_ORDER={ASC:1,DESC:2},exports.CONNECTION_STATUS={CONNECTED:0,CONNECTING:1,DISCONNECTED:2,NETWORK_UNAVAILABLE:3,SOCKET_ERROR:4,KICKED_OFFLINE_BY_OTHER_CLIENT:6,BLOCKED:12},exports.CONNECT_TYPE={COMET:\"comet\",WEBSOCKET:\"websocket\"},exports.CONVERSATION_TYPE=ie,exports.Chatroom=Z,exports.ChatroomModule=$,exports.Conversation=W,exports.ConversationModule=Y,exports.ERROR_CODE=b,exports.FILE_TYPE=ce,exports.IMClient=se,exports.MENTIONED_TYPE={ALL:1,SINGAL:2},exports.MESSAGE_DIRECTION=ae,exports.MESSAGE_TYPE={TEXT:\"RC:TxtMsg\",VOICE:\"RC:VcMsg\",HQ_VOICE:\"RC:HQVCMsg\",IMAGE:\"RC:ImgMsg\",GIF:\"RC:GIFMsg\",RICH_CONTENT:\"RC:ImgTextMsg\",LOCATION:\"RC:LBSMsg\",FILE:\"RC:FileMsg\",SIGHT:\"RC:SightMsg\",COMBINE:\"RC:CombineMsg\",CHRM_KV_NOTIFY:\"RC:chrmKVNotiMsg\",LOG_COMMAND:\"RC:LogCmdMsg\",EXPANSION_NOTIFY:\"RC:MsgExMsg\",REFERENCE:\"RC:ReferenceMsg\"},exports.MESSAGS_TIME_ORDER={DESC:0,ASC:1},exports.NOTIFICATION_STATUS=ue,exports.RECALL_MESSAGE_TYPE=\"RC:RcCmd\",exports.RECEIVED_STATUS={READ:1,LISTENED:2,DOWNLOADED:4,RETRIEVED:8,UNREAD:0},exports.RTCClient=ee,exports.SDK_VERSION=\"5.5.1\",exports.Tag=X,exports.TagModule=J,exports.getInstance=function(){return te||w.error(\"Please call the init method first\"),te},exports.init=function(t){if(w.setLogLevel(t.logLevel),w.setLogStdout(t.logStdout),te)return w.error(\"The instance already exists. Do not repeatedly call the init method\"),te;e.assert(\"options.appkey\",t.appkey,e.AssertRules.STRING,!0),e.assert(\"options.debug\",t.debug,e.AssertRules.BOOLEAN),e.assert(\"options.navigators\",t.navigators,(function(t){return e.isArray(t)&&(0===t.length||t.every(e.isHttpUrl))}));var o=null==t?void 0:t.connectType;o?e.CONNECTION_TYPE.WEBSOCKET!==o&&e.CONNECTION_TYPE.COMET!==o&&(w.warn(\"RongIMLib connectionType must be \".concat(e.CONNECTION_TYPE.WEBSOCKET,\" or \").concat(e.CONNECTION_TYPE.COMET)),o=e.CONNECTION_TYPE.WEBSOCKET):o=e.CONNECTION_TYPE.WEBSOCKET,e.logger.info(e.LogTagId.A_INIT_O,{appkey:t.appkey,navigators:t.navigators||[],connectionType:o,logLevel:t.logLevel});var n=e.APIContext.init(A,{appkey:t.appkey,apiVersion:\"5.5.1\",navigators:t.navigators||[],miniCMPProxy:t.customCMP||[],connectionType:o,logLevel:t.logLevel,logStdout:t.logStdout,indexDBSwitch:t.indexDBSwitch,checkCA:t.checkCA});return w.warn(\"RongIMLib Version: \".concat(\"5.5.1\",\", Commit: \").concat(\"70d3b5ba00858e4afab4a3c616424ad5879a8131\")),te=new se(n)};\n"]}