import{WebSocketChannel as t,CometChannel as e,NetworkType as n,HttpMethod as o,appendUrl as r,ErrorCode as s,logger as a,LogTagId as i,Logger as c,ReceivedStatus as u,assert as d,AssertRules as g,isObject as f,isArray as h,isString as p,isUndefined as m,forEach as l,map as v,ConversationType as I,MessageType as S,DelayTimer as y,isValidConversationType as C,MessageDirection as _,notEmptyString as T,RTCApiType as E,VersionManage as R,NotificationStatus as w,isValidFileType as N,isHttpUrl as O,CONNECTION_TYPE as M,APIContext as U,FileType as b,ChatroomEntryType as A}from"@rongcloud/engine";export{ChatroomEntryType,ChatroomUserChangeType,ConnectionStatus,ConversationType,ErrorCode,FileType,LogLevel,LogSource,LogTagId,MessageBlockType,MessageDirection,NotificationStatus,RTCApiType,RTCMode,UploadMethod,logger}from"@rongcloud/engine";var x=function(){return x=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},x.apply(this,arguments)};function P(t,e,n,o){return new(n||(n=Promise))((function(r,s){function a(t){try{c(o.next(t))}catch(t){s(t)}}function i(t){try{c(o.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,i)}c((o=o.apply(t,e||[])).next())}))}function L(t,e){var n,o,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,o=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}}function k(t,e,n){if(n||2===arguments.length)for(var o,r=0,s=e.length;r<s;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var D=function(){return!("undefined"==typeof uni||!function(t){for(var e=["request","getSystemInfo"],n=0,o=e.length;n<o;n++)if(!t[e[n]])return!1;return!0}(uni))},j=D();var B={tag:"browser",httpReq:function(t){var e=t.method||o.GET,n=t.timeout||6e4,s=t.headers,a=t.query,i=t.body,c=r(t.url,a);return new Promise((function(t){var o,r=(o="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,"undefined"!=typeof XMLHttpRequest&&o?new XMLHttpRequest:"undefined"!=typeof XDomainRequest?new XDomainRequest:new ActiveXObject("Microsoft.XMLHTTP")),a="[object XDomainRequest]"===Object.prototype.toString.call(r);if(r.open(e,c),s&&r.setRequestHeader)for(var u in s)r.setRequestHeader(u,s[u]);if(a){r.timeout=n,r.onload=function(){t({data:r.responseText,status:r.status||200})},r.onerror=function(){t({status:r.status||0})},r.ontimeout=function(){t({status:r.status||0})};var d="object"==typeof i?JSON.stringify(i):i;r.send(d)}else r.onreadystatechange=function(){4===r.readyState&&t({data:r.responseText,status:r.status})},r.onerror=function(){t({status:r.status||0})},setTimeout((function(){r.abort(),t({status:r.status||0})}),n),r.send(i)}))},localStorage:null===window||void 0===window?void 0:window.localStorage,sessionStorage:null===window||void 0===window?void 0:window.sessionStorage,isSupportSocket:function(){var t="undefined"!=typeof WebSocket;return t||console.warn("websocket not support"),t},useNavi:!0,connectPlatform:"",isFromUniapp:j,createWebSocket:function(t,e){var n=new WebSocket(t,e);return n.binaryType="arraybuffer",{onClose:function(t){n.onclose=function(e){var n=e.code,o=e.reason;t(n,o)}},onError:function(t){n.onerror=t},onMessage:function(t){n.onmessage=function(e){t(e.data)}},onOpen:function(t){n.onopen=t},send:function(t){n.send(t)},close:function(t,e){n.close()}}},createDataChannel:function(n,o){return this.isSupportSocket()&&"websocket"===o?new t(this,n):new e(this,n)},getNetworkType:function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection,e=t.type,o=t.effectiveType,r=e||o||n.UNKONWN;return new Promise((function(t){t(r)}))}},G=D(),K=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=a.ID();try{return a.info(i.A_CALLBACK_O,{func_name:t,source:"wechat"},{traceId:o}),wx[t].apply(wx,e)}catch(e){a.error(i.A_CALLBACK_E,{func_name:t,source:"wechat"},{traceId:o}),console.error(e)}}},H={setItem:K("setStorageSync"),getItem:K("getStorageSync"),removeItem:K("removeStorageSync"),clear:K("clearStorageSync")},V={tag:"wechat",httpReq:function(t){var e=t.method||o.GET,n=t.timeout||6e4,a=t.headers,i=t.query,c=t.body,u=r(t.url,i);return new Promise((function(t){wx.request({url:u,method:e,header:a,timeout:n,data:c,success:function(e){t({data:e.data,status:e.statusCode})},fail:function(){t({status:s.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:H,sessionStorage:H,isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:G,createWebSocket:function(t,e){var n=wx.connectSocket({url:t,protocols:e});return{onClose:function(t){n.onClose((function(e){t(e.code,e.reason)}))},onError:function(t){n.onError((function(e){t(e.errMsg)}))},onMessage:function(t){n.onMessage((function(e){t(e.data)}))},onOpen:function(t){n.onOpen(t)},send:function(t){n.send({data:t})},close:function(t,e){n.close({code:t,reason:e})}}},createDataChannel:function(n,o){return"websocket"===o?new t(this,n):new e(this,n)},getNetworkType:function(){return new Promise((function(t){wx.getNetworkType({success:function(e){var n=e.networkType;t(n)},fail:function(){t(n.UNKONWN)}})}))}},F=D(),q=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=a.ID();try{if(a.info(i.A_CALLBACK_O,{func_name:t,source:"alipay"},{traceId:o}),"setStorageSync"===t)return my[t]({key:e[0],data:JSON.parse(e[1])});if("clearStorageSync"===t)return my[t]();if("removeStorageSync"===t)return my[t]({key:e[0]});var r=my[t]({key:e[0]}).data;return r?JSON.stringify(r):r}catch(e){a.error(i.A_CALLBACK_E,{func_name:t,source:"alipay"},{traceId:o}),console.error(e)}}},W={setItem:q("setStorageSync"),getItem:q("getStorageSync"),removeItem:q("removeStorageSync"),clear:q("clearStorageSync")},X={tag:"alipay",httpReq:function(t){var e=t.method||o.GET,n=t.timeout||6e4,a=t.headers,i=t.query,c=t.body,u=r(t.url,i),d=t.dataType||"json";return new Promise((function(t){my.request({url:u,method:e,headers:a,timeout:n,data:c,dataType:d,success:function(e){t({data:e.data,status:e.status})},fail:function(){t({status:s.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:W,sessionStorage:W,isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:F,createWebSocket:function(t){return my.connectSocket({url:t}),{onClose:function(t){my.onSocketClose(t)},onError:function(t){my.onSocketError((function(e){t(e.errMsg)}))},onMessage:function(t){my.onSocketMessage((function(e){e.isBuffer?t(my.base64ToArrayBuffer(e.data)):t(e.data)}))},onOpen:function(t){my.onSocketOpen(t)},send:function(t){my.sendSocketMessage({data:my.arrayBufferToBase64(t),isBuffer:!0})},close:function(){my.closeSocket()}}},createDataChannel:function(n,o){return"websocket"===o?new t(this,n):new e(this,n)},getNetworkType:function(){return new Promise((function(t){my.getNetworkType({success:function(e){var n=e.networkType;t(n)},fail:function(){t(n.UNKONWN)}})}))}},Y=D(),J=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=a.ID();try{return a.info(i.A_CALLBACK_O,{func_name:t,source:"toutiao"},{traceId:o}),tt[t].apply(tt,e)}catch(e){a.error(i.A_CALLBACK_E,{func_name:t,source:"toutiao"},{traceId:o}),console.error(e)}}},Q={setItem:J("setStorageSync"),getItem:J("getStorageSync"),removeItem:J("removeStorageSync"),clear:J("clearStorageSync")},z={tag:"toutiao",isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:Y,localStorage:Q,sessionStorage:Q,httpReq:function(t){return new Promise((function(e,n){tt.request({url:t.url,data:t.body,header:t.headers,method:t.method,success:function(t){console.log("调用成功",t.data);var n=(null==t?void 0:t.data)||{},o={data:JSON.stringify(n),status:t.statusCode};e(o)},fail:function(t){console.log("调用失败",t.errMsg),n({data:t.errMsg})}})}))},createWebSocket:function(t,e){var n=tt.connectSocket({url:t,protocols:e});return{onOpen:function(t){n.onOpen(t)},onClose:function(t){n.onClose((function(e){return t(e.code,e.reason)}))},onError:function(t){n.onError((function(e){return t(e.errMsg)}))},onMessage:function(t){n.onMessage((function(e){return t(e.data)}))},send:function(t){n.send({data:t})},close:function(t,e){n.close({code:t,reason:e})}}},createDataChannel:function(n,o){return"websocket"===o?new t(this,n):new e(this,n)},getNetworkType:function(){return new Promise((function(t){tt.getNetworkType({success:function(e){var n=e.networkType;t(n)},fail:function(){t(n.UNKONWN)}})}))}},Z=D(),$=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=a.ID();try{return a.info(i.A_CALLBACK_O,{func_name:t,source:"baidu"},{traceId:o}),swan[t].apply(swan,e)}catch(e){a.error(i.A_CALLBACK_E,{func_name:t,source:"baidu"},{traceId:o}),console.error(e)}}},et={setItem:$("setStorageSync"),getItem:$("getStorageSync"),removeItem:$("removeStorageSync"),clear:$("clearStorageSync")},nt={tag:"baidu",isSupportSocket:function(){return!0},useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:Z,localStorage:et,sessionStorage:et,httpReq:function(t){return new Promise((function(e,n){swan.request({url:t.url,data:t.body,header:t.headers,method:t.method,success:function(t){console.log("调用成功",t.data);var n=(null==t?void 0:t.data)||{},o={data:JSON.stringify(n),status:t.statusCode};e(o)},fail:function(t){console.log("调用失败",t.errorCode),n({data:t.errorCode})}})}))},createWebSocket:function(t,e){var n=swan.connectSocket({url:t,protocols:e});return{onOpen:function(t){n.onOpen(t)},onClose:function(t){n.onClose((function(e){return t(e.code,e.reason)}))},onError:function(t){n.onError((function(e){return t(e.errMsg)}))},onMessage:function(t){n.onMessage((function(e){return t(e.data)}))},send:function(t){n.send({data:t})},close:function(t,e){n.close({code:t,reason:e})}}},createDataChannel:function(n,o){return"websocket"===o?new t(this,n):new e(this,n)},getNetworkType:function(){return P(this,void 0,void 0,(function(){return L(this,(function(t){return[2,new Promise((function(t){swan.getNetworkType({success:function(e){var n=e.networkType;t(n)},fail:function(){t(n.UNKONWN)}})}))]}))}))}},ot=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=a.ID();try{return a.info(i.A_CALLBACK_O,{func_name:t,source:"uniapp"},{traceId:o}),uni[t].apply(uni,e)}catch(e){a.error(i.A_CALLBACK_E,{func_name:t,source:"uniapp"},{traceId:o}),console.error(e)}}},rt={setItem:ot("setStorageSync"),getItem:ot("getStorageSync"),removeItem:ot("removeStorageSync"),clear:ot("clearStorageSync")},st={tag:"uniapp",httpReq:function(t){var e=t.method||o.GET,n=t.timeout||6e4,a=t.headers,i=t.query,c=t.body,u=r(t.url,i);return new Promise((function(t){uni.request({url:u,method:e,header:a,timeout:n,data:c,success:function(e){t({data:e.data,status:e.statusCode})},fail:function(){t({status:s.RC_HTTP_REQ_TIMEOUT})}})}))},localStorage:rt,sessionStorage:rt,isSupportSocket:function(){return!0},useNavi:!0,connectPlatform:"",isFromUniapp:!0,createWebSocket:function(t,e){var n={complete:function(){},url:t,protocols:e},o=uni.connectSocket(n);return{onClose:function(t){o.onClose((function(e){t(e.code,e.reason)}))},onError:function(t){o.onError((function(e){t(e.errMsg)}))},onMessage:function(t){o.onMessage((function(e){t(e.data)}))},onOpen:function(t){o.onOpen(t)},send:function(t){o.send({data:t})},close:function(t,e){o.close({code:t,reason:e})}}},createDataChannel:function(n,o){return"websocket"===o?new t(this,n):new e(this,n)},getNetworkType:function(){return new Promise((function(t){uni.getNetworkType({success:function(e){var n=e.networkType;t(n)},fail:function(){t(n.UNKONWN)}})}))}},at=function(t){return t&&t.request&&t.getSystemInfo},it="undefined"!=typeof uni&&at(uni)?function(){switch(process.env.VUE_APP_PLATFORM){case"app-plus":return st;case"mp-baidu":return nt;case"mp-toutiao":return z;case"mp-alipay":return X;case"mp-weixin":return V;default:return B}}():"undefined"!=typeof my&&at(my)?X:"undefined"!=typeof tt&&at(tt)?z:"undefined"!=typeof swan&&at(swan)?nt:"undefined"!=typeof wx&&at(wx)?V:B,ct=new c("RCIM"),ut={TIMEOUT:{code:-1,msg:"Network timeout"},SDK_INTERNAL_ERROR:{code:-2,msg:"SDK internal error"},PARAMETER_ERROR:{code:-3,msg:"Please check the parameters, the {param} expected a value of {expect} but received {current}"},REJECTED_BY_BLACKLIST:{code:405,msg:"Blacklisted by the other party"},SEND_TOO_FAST:{code:20604,msg:"Sending messages too quickly"},NOT_IN_GROUP:{code:22406,msg:"Not in group"},FORBIDDEN_IN_GROUP:{code:22408,msg:"Forbbiden from speaking in the group"},NOT_IN_CHATROOM:{code:23406,msg:"Not in chatRoom"},FORBIDDEN_IN_CHATROOM:{code:23408,msg:"Forbbiden from speaking in the chatRoom"},KICKED_FROM_CHATROOM:{code:23409,msg:"Kicked out and forbbiden from joining the chatRoom"},CHATROOM_NOT_EXIST:{code:23410,msg:"ChatRoom does not exist"},CHATROOM_IS_FULL:{code:23411,msg:"ChatRoom members exceeded"},PARAMETER_INVALID_CHATROOM:{code:23412,msg:"Invalid chatRoom parameters"},ROAMING_SERVICE_UNAVAILABLE_CHATROOM:{code:23414,msg:"ChatRoom message roaming service is not open, Please go to the developer to open this service"},RECALLMESSAGE_PARAMETER_INVALID:{code:25101,msg:"Invalid recall message parameter"},ROAMING_SERVICE_UNAVAILABLE_MESSAGE:{code:25102,msg:"Single group chat roaming service is not open, Please go to the developer to open this service"},PUSHSETTING_PARAMETER_INVALID:{code:26001,msg:"Invalid push parameter"},OPERATION_BLOCKED:{code:20605,msg:"Operation is blocked"},OPERATION_NOT_SUPPORT:{code:20606,msg:"Operation is not supported"},MSG_BLOCKED_SENSITIVE_WORD:{code:21501,msg:"The sent message contains sensitive words"},REPLACED_SENSITIVE_WORD:{code:21502,msg:"Sensitive words in the message have been replaced"},NOT_CONNECTED:{code:30001,msg:"Please connect successfully first"},NAVI_REQUEST_ERROR:{code:30007,msg:"Navigation http request failed"},CMP_REQUEST_ERROR:{code:30010,msg:"CMP sniff http request failed"},CONN_APPKEY_FAKE:{code:31002,msg:"Your appkey is fake"},CONN_MINI_SERVICE_NOT_OPEN:{code:31003,msg:"Mini program service is not open, Please go to the developer to open this service"},CONN_ACK_TIMEOUT:{code:31e3,msg:"Connection ACK timeout"},CONN_TOKEN_INCORRECT:{code:31004,msg:"Your token is not valid or expired"},CONN_NOT_AUTHRORIZED:{code:31005,msg:"AppKey and Token do not match"},CONN_REDIRECTED:{code:31006,msg:"Connection redirection"},CONN_APP_BLOCKED_OR_DELETED:{code:31008,msg:"AppKey is banned or deleted"},CONN_USER_BLOCKED:{code:31009,msg:"User blocked"},CONN_DOMAIN_INCORRECT:{code:31012,msg:"Connect domain error, Please check the set security domain"},ROAMING_SERVICE_UNAVAILABLE:{code:33007,msg:"Roaming service cloud is not open, Please go to the developer to open this service"},RC_CONNECTION_EXIST:{code:34001,msg:"Connection already exists"},CHATROOM_KV_EXCEED:{code:23423,msg:"ChatRoom KV setting exceeds maximum"},CHATROOM_KV_OVERWRITE_INVALID:{code:23424,msg:"ChatRoom KV already exists"},CHATROOM_KV_STORE_NOT_OPEN:{code:23426,msg:"ChatRoom KV storage service is not open, Please go to the developer to open this service"},CHATROOM_KEY_NOT_EXIST:{code:23427,msg:"ChatRoom key does not exist"},MSG_KV_NOT_SUPPORT:{code:34008,msg:"The message cannot be extended"},SEND_MESSAGE_KV_FAIL:{code:34009,msg:"Sending RC expansion message fail"},EXPANSION_LIMIT_EXCEET:{code:34010,msg:"The message expansion size is beyond the limit"},ILLGAL_PARAMS:{code:33003,msg:"Incorrect parameters passed in while calling the interface"},CHATROOM_KV_STORE_NOT_ALL_SUCCESS:{code:23428,msg:"Chatroom kv store not all success"},CHATROOM_KV_STORE_OUT_LIMIT:{code:23429,msg:"chatroom kv's length is out of limit"}},dt={};for(var gt in ut){var ft=ut[gt].code;dt[ft]=gt}ut.ROAMING_SERVICE_UNAVAILABLE.code;var ht={CONNECTED:0,CONNECTING:1,DISCONNECTED:2,NETWORK_UNAVAILABLE:3,SOCKET_ERROR:4,KICKED_OFFLINE_BY_OTHER_CLIENT:6,BLOCKED:12},pt={COMET:"comet",WEBSOCKET:"websocket"},mt={DESC:0,ASC:1},lt={ASC:1,DESC:2},vt="RC:RcCmd",It={ALL:1,SINGAL:2},St={TEXT:"RC:TxtMsg",VOICE:"RC:VcMsg",HQ_VOICE:"RC:HQVCMsg",IMAGE:"RC:ImgMsg",GIF:"RC:GIFMsg",RICH_CONTENT:"RC:ImgTextMsg",LOCATION:"RC:LBSMsg",FILE:"RC:FileMsg",SIGHT:"RC:SightMsg",COMBINE:"RC:CombineMsg",CHRM_KV_NOTIFY:"RC:chrmKVNotiMsg",LOG_COMMAND:"RC:LogCmdMsg",EXPANSION_NOTIFY:"RC:MsgExMsg",REFERENCE:"RC:ReferenceMsg"},yt={READ:1,LISTENED:2,DOWNLOADED:4,RETRIEVED:8,UNREAD:0},Ct="5.5.1";function _t(t){var e=t.conversationType,n=t.messageType,o=t.content,r=t.senderUserId,s=t.targetId,a=t.sentTime,i=t.receivedTime,c=t.messageUId,d=t.messageDirection,g=t.isPersited,f=t.isCounted,h=t.isOffLineMessage,p=t.canIncludeExpansion,m=t.expansion,l=t.receivedStatus,v=t.disableNotification,I=t.isMentioned,S=t.isStatusMessage,y=t.readReceiptInfo;return l||(l=u.UNREAD),{messageType:n,content:o,senderUserId:r,targetId:s,type:e,sentTime:a,receivedTime:i,messageUId:c,messageDirection:d,isPersited:g,isCounted:f,isOffLineMessage:h,isMentioned:I,disableNotification:v,isStatusMessage:S,canIncludeExpansion:p,expansion:m,receivedStatus:l,readReceiptInfo:y}}function Tt(t){var e=t.conversationType,n=t.targetId,o=t.latestMessage,r=t.unreadMessageCount,s=t.hasMentioned,a=t.mentionedInfo,i=t.lastUnreadTime,c=t.notificationStatus,u=t.isTop;return{type:e,targetId:n,latestMessage:o&&_t(o),unreadMessageCount:r,hasMentioned:s,mentionedInfo:s?{type:null==a?void 0:a.type,userIdList:null==a?void 0:a.userIdList}:void 0,lastUnreadTime:i,notificationStatus:c,isTop:u}}function Et(t){d("options.messageType",t.messageType,g.STRING,!0),d("options.content",t.content,(function(t){return f(t)}),!0),d("options.isPersited",t.isPersited,g.BOOLEAN),d("options.isCounted",t.isCounted,g.BOOLEAN),d("options.pushContent",t.pushContent,g.STRING),d("options.pushData",t.pushData,g.STRING),d("options.isVoipPush",t.isVoipPush,g.BOOLEAN),d("options.isStatusMessage",t.isStatusMessage,g.BOOLEAN),d("options.isMentioned",t.isMentioned,g.BOOLEAN),d("options.mentionedType",t.mentionedType,g.NUMBER),d("options.mentionedUserIdList",t.mentionedUserIdList,(function(t){return h(t)&&(0===t.length||t.every(p))})),d("options.directionalUserIdList",t.directionalUserIdList,(function(t){return h(t)&&(0===t.length||t.every(p))})),m(t.isPersited)&&m(t.isCounted)&&m(t.isStatusMessage)||ct.warn("The parameters `isPersited`, `isCounted`, `isStatusMessage` will be deprecated in future releases due to inconsistance of the values on mobile side and web side. Please use `registerMessageType` instead for non-integrated message type.")}var Rt=function(t,e){if(!t)return[];var n=wt(t),o=Ot(n.topConversationList,e),r=Ot(n.unToppedConversationList,e);return o.push.apply(o,r),o},wt=function(t){var e=[],n=[];return l(t,(function(t){var o=t.hasMentioned,r=t.mentionedInfo;t.hasMentioned=o,t.mentionedInfo=r,t.isTop||!1?e.push(t):n.push(t)})),{topConversationList:e||[],unToppedConversationList:n||[]}},Nt=function(t){var e=t.type,n=t.targetId;return"".concat(e,"_").concat(n)},Ot=function(t,e){return void 0===e&&(e=0),Ut(t,(function(t,n){n=n||{};var o=(t=t||{}).latestMessage||{},r=n.latestMessage||{},s=o.sentTime||0,a=r.sentTime||0;return e?a>=s:a<=s}))},Mt=function(t){var e=(t=t||{}).targetId,n=t.type,o=I.PRIVATE,r={messageType:S.TextMessage,sentTime:y.getTime(),content:{content:""},senderUserId:e,targetId:e,type:n};return t.type=n||o,t.targetId=e||"",t.latestMessage=t.latestMessage||r,t},Ut=function(t,e){var n=function(t,e,o,r){if(r=r||function(t,e){return t<=e},e<o){for(var s=t[o],a=e-1,i=void 0,c=e;c<=o;c++)r(t[c],s)&&(i=t[++a],t[a]=t[c],t[c]=i);n(t,e,a-1,r),n(t,a+1,o,r)}return t};return n(t,0,t.length-1,e)},bt=function(t){return!t.type||!t.targetId||!f(t.latestMessage)||m(t.unreadMessageCount)},At=function(t,e,n){var o=(n=n||{}).isAllowNull;for(var r in t=t||{},e=e||{}){var s=e[r];m(s)&&!o||(t[r]=s)}return t},xt=function(t){return{targetId:t.targetId,channelId:t.channelId,conversationType:t.type}},Pt=function(){function t(t,e){this._context=t,this.targetId=e.targetId,this.type=e.type}return t.prototype.destory=function(){return P(this,void 0,void 0,(function(){var t,e;return L(this,(function(n){switch(n.label){case 0:return[4,this._context.removeConversation(this.type,this.targetId)];case 1:return t=n.sent(),e="type:".concat(this.type,",targetId:").concat(this.targetId),ct.debug("destroy conversation ->".concat(e)),t!==s.SUCCESS?(ct.warn("destroy conversation fail ->".concat(t,":").concat(dt[t],",").concat(e)),[2,Promise.reject({code:t,msg:dt[t]})]):[2]}}))}))},t.prototype.read=function(){return P(this,void 0,void 0,(function(){var t,e;return L(this,(function(n){switch(n.label){case 0:return[4,this._context.clearUnreadCount(this.type,this.targetId)];case 1:return t=n.sent(),e="type:".concat(this.type,",targetId:").concat(this.targetId),ct.debug("clear unreadMsgNum ->".concat(e)),t!==s.SUCCESS?(ct.warn("clear unreadMsgNum fail ->".concat(t,":").concat(dt[t],",").concat(e)),[2,Promise.reject({code:t,msg:dt[t]})]):[2]}}))}))},t.prototype.getUnreadCount=function(){return P(this,void 0,void 0,(function(){var t,e,n,o;return L(this,(function(r){switch(r.label){case 0:return[4,this._context.getUnreadCount(this.type,this.targetId)];case 1:return t=r.sent(),e=t.code,n=t.data,o="type:".concat(this.type,",targetId:").concat(this.targetId),ct.debug("get unreadCount ->".concat(o)),e===s.SUCCESS?[2,n]:(ct.warn("get unreadCount fail ->".concat(e,":").concat(dt[e],",").concat(o)),[2,Promise.reject({code:e,msg:dt[e]})])}}))}))},t.prototype.send=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r,c;return L(this,(function(d){switch(d.label){case 0:return Et(t),Object.prototype.hasOwnProperty.call(t,"isPersited")||(t.isPersited=!0),Object.prototype.hasOwnProperty.call(t,"isCounted")||(t.isCounted=!0),e="type:".concat(this.type,",targetId:").concat(this.targetId),ct.debug("send message  ->".concat(e)),n=a.ID(),a.info(i.A_SEND_MSG_T,{messageType:t.messageType,conversationType:this.type,target:this.targetId,channelId:t.channelId},{traceId:n}),[4,this._context.sendMessage(this.type,this.targetId,t,void 0,n)];case 1:return o=d.sent(),r=o.code,c=o.data,(r===s.SUCCESS?a.info:a.warn)(i.A_SEND_MSG_R,{code:r,messageUId:c?c.messageUId:"",messageId:c?c.messageId:""},{traceId:n}),r===s.SUCCESS?[2,_t(c)]:(ct.warn("send message fail ->".concat(r,":").concat(dt[r],",").concat(e)),[2,Promise.reject({code:r,msg:dt[r],data:_t({isMentioned:!!t.isMentioned,content:t.content,messageType:t.messageType,isPersited:t.isPersited||!1,isCounted:t.isCounted||!1,disableNotification:!!(null==t?void 0:t.disableNotification),canIncludeExpansion:!!(null==t?void 0:t.canIncludeExpansion),expansion:(null==t?void 0:t.expansion)||null,conversationType:this.type,targetId:this.targetId,senderUserId:this._context.getCurrentUserId(),messageUId:"",messageDirection:_.SEND,isOffLineMessage:!1,sentTime:(null==c?void 0:c.sentTime)||0,receivedTime:0,isStatusMessage:t.isStatusMessage||!1,receivedStatus:u.UNREAD})})])}}))}))},t.prototype.setStatus=function(t){return P(this,void 0,void 0,(function(){var e,n;return L(this,(function(o){switch(o.label){case 0:return d("options.notificationStatus",t.notificationStatus,(function(t){return 1===t||2===t})),d("options.isTop",t.isTop,g.BOOLEAN),e="type:".concat(this.type,",targetId:").concat(this.targetId),ct.debug("set conversation status ->".concat(e)),[4,this._context.setConversationStatus(this.type,this.targetId,t.isTop,t.notificationStatus)];case 1:return(n=o.sent())!==s.SUCCESS?(ct.warn("set conversation status fail ->".concat(n,":").concat(dt[n],",").concat(e)),[2,Promise.reject({code:n,msg:dt[n]})]):[2]}}))}))},t.prototype.getMessages=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r,c,u,f;return L(this,(function(h){switch(h.label){case 0:return d("options.timestamp",t.timestamp,g.NUMBER),d("options.count",t.count,g.NUMBER),d("options.order",t.order,(function(t){return 0===t||1===t})),e="type:".concat(this.type,",targetId:").concat(this.targetId),ct.debug("get history message ->".concat(e)),n=a.ID(),a.info(i.A_GET_HISTORY_MSG_T,{targetId:this.targetId,conversationType:this.type,channelId:"",timestamp:t.timestamp,count:t.count},{traceId:n}),[4,this._context.getHistoryMessage(this.type,this.targetId,null==t?void 0:t.timestamp,null==t?void 0:t.count,null==t?void 0:t.order)];case 1:return o=h.sent(),r=o.code,c=o.data,r===s.SUCCESS&&c?(u=[],f=c.list.map((function(t){var e=_t(t);return u.push(e.messageUId),e})),a.info(i.A_GET_HISTORY_MSG_R,{code:r,messageUIds:u.join(",")},{traceId:n}),[2,Promise.resolve({list:f,hasMore:c.hasMore})]):(a.warn(i.A_GET_HISTORY_MSG_R,{code:r,messageUIds:""},{traceId:n}),ct.warn("get history message fail ->".concat(r,":").concat(dt[r],",").concat(e)),[2,Promise.reject({code:r,msg:dt[r]})])}}))}))},t.prototype.recall=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r,a;return L(this,(function(i){switch(i.label){case 0:return d("options.messageUId",t.messageUId,g.STRING,!0),d("options.sentTime",t.sentTime,g.NUMBER,!0),d("options.disableNotification",null==t?void 0:t.disableNotification,g.BOOLEAN),d("options.pushConfig",null==t?void 0:t.pushConfig,g.OBJECT),d("options.extra",null==t?void 0:t.extra,g.STRING),e={user:t.user,channelId:"",disableNotification:null==t?void 0:t.disableNotification,pushConfig:null==t?void 0:t.pushConfig,extra:t.extra},n="type:".concat(this.type,",targetId:").concat(this.targetId,",messageUId:").concat(t.messageUId),ct.debug("recall message ->".concat(n)),[4,this._context.recallMessage(this.type,this.targetId,t.messageUId,t.sentTime,e)];case 1:return o=i.sent(),r=o.code,a=o.data,r===s.SUCCESS&&a?[2,_t(a)]:(ct.warn("recall message fail ->".concat(r,":").concat(dt[r],",").concat(n)),[2,Promise.reject({code:r,msg:dt[r]})])}}))}))},t.prototype.deleteMessages=function(t){return P(this,void 0,void 0,(function(){var e,n;return L(this,(function(o){switch(o.label){case 0:return d("options",t,(function(t){return h(t)&&t.length}),!0),t.forEach((function(t){d("options.messageUId",t.messageUId,g.STRING,!0),d("options.sentTime",t.sentTime,g.NUMBER,!0),d("options.messageDirection",t.messageDirection,(function(t){return 1===t||2===t}),!0)})),e="type:".concat(this.type,",targetId:").concat(this.targetId),ct.debug("delete messages ->".concat(e)),[4,this._context.deleteRemoteMessage(this.type,this.targetId,t)];case 1:return(n=o.sent())!==s.SUCCESS?(ct.warn("delete message fail ->".concat(n,":").concat(dt[n],",").concat(e)),[2,Promise.reject({code:n,msg:dt[n]})]):[2]}}))}))},t.prototype.clearMessages=function(t){return P(this,void 0,void 0,(function(){var e,n;return L(this,(function(o){switch(o.label){case 0:return d("options.timestamp",t.timestamp,g.NUMBER,!0),e="type:".concat(this.type,",targetId:").concat(this.targetId),ct.debug("clear message ->".concat(e)),[4,this._context.deleteRemoteMessageByTimestamp(this.type,this.targetId,t.timestamp)];case 1:return(n=o.sent())!==s.SUCCESS?(ct.warn("clear message ->".concat(n,":").concat(dt[n],",").concat(e)),[2,Promise.reject({code:n,msg:dt[n]})]):[2]}}))}))},t.prototype.updateMessageExpansion=function(t,e){return P(this,void 0,void 0,(function(){var n,o,r,a,i,c,u;return L(this,(function(f){switch(f.label){case 0:return d("expansion",t,g.OBJECT,!0),d("message",e,g.OBJECT,!0),n=e.type,o=e.targetId,r=e.messageUId,a=e.canIncludeExpansion,i=e.expansion,c="type:".concat(n,",targetId:").concat(this.targetId,",messageUId:").concat(r),ct.debug("update message expansion ->".concat(c)),[4,this._context.sendExpansionMessage({conversationType:n,targetId:o,messageUId:r,expansion:t,canIncludeExpansion:a,originExpansion:i,channelId:""})];case 1:return(u=f.sent().code)!==s.SUCCESS?(ct.warn("update message expansion fail ->".concat(u,":").concat(dt[u],",").concat(c)),[2,Promise.reject({code:u,msg:dt[u]})]):[2]}}))}))},t.prototype.removeMessageExpansion=function(t,e){return P(this,void 0,void 0,(function(){var n,o,r,a,i,c;return L(this,(function(u){switch(u.label){case 0:return d("keys",t,g.ARRAY,!0),d("message",e,g.OBJECT,!0),n=e.type,o=e.targetId,r=e.messageUId,a=e.canIncludeExpansion,i="type:".concat(n,",targetId:").concat(this.targetId,",messageUId:").concat(r),ct.debug("remove message expansion ->".concat(i)),[4,this._context.sendExpansionMessage({conversationType:n,targetId:o,messageUId:r,canIncludeExpansion:a,keys:t,channelId:""})];case 1:return(c=u.sent().code)!==s.SUCCESS?(ct.warn("remove message expansion fail ->".concat(c,":").concat(dt[c],",").concat(i)),[2,Promise.reject({code:c,msg:dt[c]})]):[2]}}))}))},t.prototype.setDraft=function(t){return P(this,void 0,void 0,(function(){var e,n;return L(this,(function(o){switch(o.label){case 0:return d("draft",t,g.STRING,!0),e="type:".concat(this.type,",targetId:").concat(this.targetId),ct.debug("set draft ->".concat(e)),[4,this._context.saveConversationMessageDraft(this.type,this.targetId,t)];case 1:return(n=o.sent())===s.SUCCESS?[2,Promise.resolve()]:(ct.warn("set draft fail ->".concat(n,":").concat(dt[n],",").concat(e)),[2])}}))}))},t.prototype.getDraft=function(){return P(this,void 0,void 0,(function(){var t,e,n,o;return L(this,(function(r){switch(r.label){case 0:return[4,this._context.getConversationMessageDraft(this.type,this.targetId)];case 1:return t=r.sent(),e=t.code,n=t.data,o="type:".concat(this.type,",targetId:").concat(this.targetId),ct.debug("get draft ->".concat(o)),e===s.SUCCESS?[2,Promise.resolve(n)]:(ct.warn("get draft fail ->".concat(e,":").concat(dt[e],",").concat(o)),[2,Promise.reject({code:e,msg:dt[e]})])}}))}))},t.prototype.deleteDraft=function(){return P(this,void 0,void 0,(function(){var t,e;return L(this,(function(n){switch(n.label){case 0:return t="type:".concat(this.type,",targetId:").concat(this.targetId),ct.debug("delete draft  ->".concat(t)),[4,this._context.clearConversationMessageDraft(this.type,this.targetId)];case 1:return(e=n.sent())===s.SUCCESS?[2,Promise.resolve()]:(ct.warn("delete draft fail ->".concat(e,":").concat(dt[e],",").concat(t)),[2])}}))}))},t.prototype.sendReadReceiptMessage=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r,a;return L(this,(function(i){switch(i.label){case 0:for(d("messageUIds",t,g.ARRAY,!0),e=0,n=t;e<n.length;e++)o=n[e],d("messageUId",o,g.STRING);return r="messageUIds:".concat(t.join(","),",targetId:").concat(this.targetId),ct.debug("send read receipt message ->".concat(r)),[4,this._context.sendReadReceiptMessage(this.targetId,t)];case 1:return(a=i.sent().code)===s.SUCCESS?[2,Promise.resolve()]:(ct.warn("send read receipt message fail ->".concat(a,":").concat(dt[a],",").concat(r)),[2,Promise.reject(a)])}}))}))},t.prototype.sendTypingStatusMessage=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r,c,u;return L(this,(function(f){switch(f.label){case 0:return d("typingContentType",t,g.STRING,!0),e="type:".concat(this.type,",targetId:").concat(this.targetId),ct.debug("send typing status message ->".concat(e)),n={messageType:"RC:TypSts",content:{typingContentType:t},isStatusMessage:!0,channelId:""},o=a.ID(),a.info(i.A_SEND_MSG_T,{messageType:n.messageType,conversationType:this.type,targetId:this.targetId,channelId:n.channelId},{traceId:o}),[4,this._context.sendMessage(this.type,this.targetId,n,void 0,o)];case 1:return r=f.sent(),c=r.code,u=r.data,(c===s.SUCCESS?a.info:a.warn)(i.A_SEND_MSG_R,{code:c,messageUId:u?u.messageUId:"",messageId:u?u.messageId:""},{traceId:o}),c===s.SUCCESS?[2,_t(u)]:(ct.warn("send typing status message fail ->".concat(c,":").concat(dt[c],",").concat(e)),[2,Promise.reject({code:c,msg:dt[c]})])}}))}))},t.prototype.getMessageReader=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r;return L(this,(function(a){switch(a.label){case 0:return d("messageUId",t,g.STRING,!0),e="messageUId:".concat(t,",targetId:").concat(this.targetId),ct.debug("get message reader ->".concat(e)),[4,this._context.getMessageReader(this.targetId,t)];case 1:return n=a.sent(),o=n.code,r=n.data,o===s.SUCCESS?[2,Promise.resolve(r)]:(ct.warn("get message reader fail ->".concat(o,":").concat(dt[o],",").concat(e)),[2,Promise.reject(o)])}}))}))},t.prototype.getInfo=function(){return P(this,void 0,void 0,(function(){var t,e,n;return L(this,(function(o){switch(o.label){case 0:return[4,this._context.getConversation(this.type,this.targetId,"")];case 1:return t=o.sent(),e=t.code,n=t.data,e===s.SUCCESS&&n?[2,Tt(n)]:[2,Promise.reject({code:e,msg:dt[e]})]}}))}))},t.prototype.removeTags=function(t){return P(this,void 0,void 0,(function(){var e;return L(this,(function(n){switch(n.label){case 0:return d("tagIds",t,g.ARRAY,!0),t.forEach((function(t){d("tagId",t,g.STRING,!0)})),ct.info("removeTags ->targetId:".concat(this.targetId,",type:").concat(this.type)),[4,this._context.removeTagsForConversation({conversationType:this.type,targetId:this.targetId},t)];case 1:return(e=n.sent().code)===s.SUCCESS?[2,e]:(ct.warn("removeTags fail ->".concat(e,":").concat(dt[e])),[2,Promise.reject({code:e,msg:dt[e]})])}}))}))},t.prototype.getTags=function(){return P(this,void 0,void 0,(function(){var t,e,n;return L(this,(function(o){switch(o.label){case 0:return ct.info("getTags ->targetId:".concat(this.targetId,",type:").concat(this.type)),[4,this._context.getTagsForConversation({conversationType:this.type,targetId:this.targetId})];case 1:return t=o.sent(),e=t.code,n=t.data,e===s.SUCCESS?[2,n||[]]:(ct.warn("getTags fail ->".concat(e,":").concat(dt[e])),[2,Promise.reject({code:e,msg:dt[e]})])}}))}))},t}(),Lt=function(){function t(t){this._context=t}return t.prototype.getList=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r;return L(this,(function(a){switch(a.label){case 0:return ct.debug("get conversation list ->"),[4,this._context.getConversationList(null==t?void 0:t.count,void 0,null==t?void 0:t.startTime,null==t?void 0:t.order)];case 1:return e=a.sent(),n=e.code,o=e.data,n===s.SUCCESS&&o?(r=o.map((function(t){return Tt(t)})),[2,Rt(r)]):(ct.warn("get conversation list fail ->".concat(n,":").concat(dt[n])),[2,Promise.reject({code:n,msg:dt[n]})])}}))}))},t.prototype.get=function(t){return d("options.type",t.type,C,!0),new Pt(this._context,t)},t.prototype.remove=function(t){return d("options.type",t.type,C,!0),new Pt(this._context,t).destory()},t.prototype.getTotalUnreadCount=function(t,e){return P(this,void 0,void 0,(function(){var n,o,r,a,i,c;return L(this,(function(u){switch(u.label){case 0:if(ct.debug("get total unread count -> ConversationType:".concat(JSON.stringify(e)," includeMuted:").concat(t)),d("includeMuted",t,g.BOOLEAN,!1),d("conversationTypes",e,g.ARRAY,!1),e)for(n=0,o=e;n<o.length;n++)r=o[n],d("conversationType",r,g.NUMBER);return[4,this._context.getTotalUnreadCount("",e,t)];case 1:return a=u.sent(),i=a.code,c=a.data,i===s.SUCCESS?[2,c]:(ct.warn("getTotalUnreadCount fail ->".concat(i,":").concat(dt[i])),[2,Promise.reject({code:i,msg:dt[i]})])}}))}))},t.prototype.readAll=function(){return P(this,void 0,void 0,(function(){return L(this,(function(t){return[2,this._context.clearAllUnreadCount()]}))}))},t.prototype.merge=function(t){return t.conversationList||ct.warn("Parameter option.conversationList are required!"),function(t){var e=(t=t||{}).conversationList,n=t.updatedConversationList;e=e||[];var o=k(k([],n=n||[],!0),e,!0),r={},s=[],a=[];return l(o,(function(t){if(f(t)){var e=t.type,n=t.targetId,o=Nt({type:e,targetId:n}),i=r[o]||{},c=m(i.index)?s.length:i.index,u=i.val||{},d=u.updatedItems||{},g=t.updatedItems;t=At(t,u),l(d,(function(e,n){t[n]=e.val})),l(g,(function(e,n){var o=(d[n]||{}).time||0;e.time>o&&(t[n]=e.val)})),r[o]={index:c,val:t},s[c]=t,bt(t)&&a.push(c)}})),l(a,(function(t){var e=s[t];s[t]=Mt(e)})),s=Rt(s),v(s,(function(t){return delete t.updatedItems,t}))}(t)},t}(),kt=function(){function t(t,e){this._context=t,this.tagId=e}return t.prototype.update=function(t){return P(this,void 0,void 0,(function(){var e;return L(this,(function(n){switch(n.label){case 0:return d("tagName",t,g.STRING,!0),d("tagName",t,(function(t){return t.length<=15})),ct.info("update ->tagId:".concat(this.tagId,",tagName:").concat(t)),[4,this._context.updateTag({tagId:this.tagId,tagName:t})];case 1:return(e=n.sent().code)===s.SUCCESS?[2,e]:(ct.warn("update ->code:".concat(e,",tagId:").concat(this.tagId)),[2,Promise.reject({code:e,msg:dt[e]})])}}))}))},t.prototype.remove=function(){return P(this,void 0,void 0,(function(){var t;return L(this,(function(e){switch(e.label){case 0:return ct.info("remove ->tagId:".concat(this.tagId)),[4,this._context.removeTag(this.tagId)];case 1:return(t=e.sent().code)===s.SUCCESS?[2,t]:(ct.warn("remove ->code:".concat(t,",tagId:").concat(this.tagId)),[2,Promise.reject({code:t,msg:dt[t]})])}}))}))},t.prototype.addConversations=function(t){return P(this,void 0,void 0,(function(){var e;return L(this,(function(n){switch(n.label){case 0:return d("conversations",t,g.ARRAY,!0),t.forEach((function(t){d("conversation.type",t.type,g.NUMBER,!0),d("conversation.targetId",t.targetId,g.STRING,!0)})),ct.info("addConversations ->tagId:".concat(this.tagId)),[4,this._context.addTagForConversations(this.tagId,t.map((function(t){return xt(t)})))];case 1:return(e=n.sent().code)===s.SUCCESS?[2,e]:(ct.warn("addConversations ->code:".concat(e,",tagId:").concat(this.tagId)),[2,Promise.reject({code:e,msg:dt[e]})])}}))}))},t.prototype.removeConversations=function(t){return P(this,void 0,void 0,(function(){var e;return L(this,(function(n){switch(n.label){case 0:return ct.info("removeConversations ->tagId:".concat(this.tagId)),[4,this._context.removeTagForConversations(this.tagId,t.map((function(t){return xt(t)})))];case 1:return(e=n.sent().code)===s.SUCCESS?[2,e]:(ct.warn("removeConversations ->code:".concat(e,",tagId:").concat(this.tagId)),[2,Promise.reject({code:e,msg:dt[e]})])}}))}))},t.prototype.getConversationList=function(t,e){return P(this,void 0,void 0,(function(){var n,o,r,a;return L(this,(function(i){switch(i.label){case 0:return d("count",e,g.NUMBER,!0),d("startTime",t,g.NUMBER,!0),ct.info("getConversationList ->tagId:".concat(this.tagId)),[4,this._context.getConversationListByTag(this.tagId,t,e)];case 1:return n=i.sent(),o=n.data,r=n.code,a=[],r===s.SUCCESS?((o=o||[]).forEach((function(t){var e=t.channelId,n=t.conversationType,o=t.targetId,r=t.unreadMessageCount,s=t.latestMessage,i=t.hasMentioned,c=t.mentionedInfo,u=t.notificationStatus,d=t.isTop,g=t.lastUnreadTime,f=t.isTopInTag;a.push({channelId:e,conversationType:n,targetId:o,unreadMessageCount:r,latestMessage:s,hasMentioned:i,mentionedInfo:c,notificationStatus:u,isTop:d,lastUnreadTime:g,isTopInTag:f})})),[2,a]):(ct.warn("getConversationList ->code:".concat(r,",tagId:").concat(this.tagId)),[2,Promise.reject({code:r,msg:dt[r]})])}}))}))},t.prototype.getUnreadCount=function(t){return P(this,void 0,void 0,(function(){var e,n,o;return L(this,(function(r){switch(r.label){case 0:return d("isIncludeNotNotification",t,g.BOOLEAN,!0),ct.info("getUnreadCount ->tagId:".concat(this.tagId)),[4,this._context.getUnreadCountByTag(this.tagId,t)];case 1:return e=r.sent(),n=e.data,(o=e.code)===s.SUCCESS?[2,n||0]:(ct.warn("getUnreadCount ->code:".concat(o,",tagId:").concat(this.tagId)),[2,Promise.reject({code:o,msg:dt[o]})])}}))}))},t.prototype.updateConversationIsTop=function(t,e){return P(this,void 0,void 0,(function(){var n;return L(this,(function(o){switch(o.label){case 0:return d("conversation.targetId",t.targetId,g.STRING,!0),d("conversation.type",t.type,g.NUMBER,!0),d("isTop",e,g.BOOLEAN,!0),ct.info("updateConversationIsTop ->tagId:".concat(this.tagId)),[4,this._context.setConversationStatusInTag(this.tagId,xt(t),{isTop:e})];case 1:return(n=o.sent().code)===s.SUCCESS?[2,n]:(ct.warn("updateConversationIsTop ->code:".concat(n,",tagId:").concat(this.tagId)),[2,Promise.reject({code:n,msg:dt[n]})])}}))}))},t}(),Dt=function(){function t(t){this._context=t}return t.prototype.create=function(t){return P(this,void 0,void 0,(function(){var e;return L(this,(function(n){switch(n.label){case 0:return d("tag.tagId",t.tagId,g.STRING,!0),d("tag.tagId",t.tagId,(function(t){return t.length<=10})),d("tag.tagName",t.tagName,(function(t){return t.length<=15})),d("tag.tagName",t.tagName,g.STRING,!0),ct.info("create tag->tagId:".concat(t.tagId,",tagName:").concat(t.tagName)),[4,this._context.createTag(t)];case 1:return(e=n.sent().code)===s.SUCCESS?[2,e]:(ct.warn("create tag fail ->".concat(e,":").concat(dt[e])),[2,Promise.reject({code:e,msg:dt[e]})])}}))}))},t.prototype.getTagInfoList=function(){return P(this,void 0,void 0,(function(){var t,e,n;return L(this,(function(o){switch(o.label){case 0:return[4,this._context.getTagList()];case 1:return t=o.sent(),e=t.code,n=t.data,e===s.SUCCESS?[2,n||[]]:(ct.warn("getTagInfoList ->code:".concat(e)),[2,Promise.reject({code:e,msg:dt[e]})])}}))}))},t.prototype.get=function(t){return P(this,void 0,void 0,(function(){return L(this,(function(e){return d("tag.tagId",t,g.STRING,!0),d("tag.tagId",t,(function(t){return t.length<=10})),[2,new kt(this._context,t)]}))}))},t}(),jt=function(t){d("options.key",t.key,g.STRING,!0),d("options.value",t.value,g.STRING,!0),d("options.isAutoDelete",t.isAutoDelete,g.BOOLEAN),d("options.isSendNotification",t.isSendNotification,g.BOOLEAN),d("options.notificationExtra",t.notificationExtra,g.STRING)},Bt=function(t){d("options.key",t.key,g.STRING,!0),d("options.isSendNotification",t.isSendNotification,g.BOOLEAN),d("options.notificationExtra",t.notificationExtra,g.STRING)},Gt=function(){function t(t,e){this._context=t,this._id=e}return t.prototype.join=function(t){return P(this,void 0,void 0,(function(){var e,n,o;return L(this,(function(r){switch(r.label){case 0:return d("options.count",t.count,g.NUMBER,!0),e="id:".concat(this._id),ct.debug("join chatroom ->".concat(e)),n=a.ID(),a.info(i.A_JOIN_CHATROOM_T,{chatroomId:this._id,count:t.count,joinExist:!1},{traceId:n}),[4,this._context.joinChatroom(this._id,t.count,n)];case 1:return o=r.sent(),(o===s.SUCCESS?a.info:a.warn)(i.A_JOIN_CHATROOM_R,{code:o,timestamp:(new Date).getTime()},{traceId:n}),o!==s.SUCCESS?(ct.warn("join chatroom fail ->code+:".concat(dt[o],",").concat(e)),[2,Promise.reject({code:o,msg:dt[o]})]):[2]}}))}))},t.prototype.joinExist=function(t){return P(this,void 0,void 0,(function(){var e,n,o;return L(this,(function(r){switch(r.label){case 0:return d("options.count",t.count,g.NUMBER,!0),e="id:".concat(this._id),ct.debug("join exist chatroom ->".concat(e)),n=a.ID(),a.info(i.A_JOIN_CHATROOM_T,{chatroomId:this._id,count:t.count,joinExist:!0},{traceId:n}),[4,this._context.joinExistChatroom(this._id,t.count,n)];case 1:return o=r.sent(),(o===s.SUCCESS?a.info:a.warn)(i.A_JOIN_CHATROOM_R,{code:o,timestamp:(new Date).getTime()},{traceId:n}),o!==s.SUCCESS?(ct.warn("join exist chatroom fail ->code:".concat(dt[o],",").concat(e)),[2,Promise.reject({code:o,msg:dt[o]})]):[2]}}))}))},t.prototype.quit=function(){return P(this,void 0,void 0,(function(){var t,e,n;return L(this,(function(o){switch(o.label){case 0:return t="id:".concat(this._id),ct.debug("quit chatroom ->".concat(t)),e=a.ID(),a.info(i.A_QUIT_CHATROOM_T,{chatroomId:this._id},{traceId:e}),[4,this._context.quitChatroom(this._id)];case 1:return n=o.sent(),(n===s.SUCCESS?a.info:a.warn)(i.A_QUIT_CHATROOM_R,{code:n},{traceId:e}),n!==s.SUCCESS?(ct.warn("quit chatroom fail ->code+:".concat(dt[n],",").concat(t)),[2,Promise.reject({code:n,msg:dt[n]})]):[2]}}))}))},t.prototype.getInfo=function(t){return void 0===t&&(t={}),P(this,void 0,void 0,(function(){var e,n,o,r;return L(this,(function(a){switch(a.label){case 0:return d("options.count",t.count,g.NUMBER),d("options.order",t.order,(function(t){return[0,1,2].includes(t)})),e="id:".concat(this._id),ct.debug("get chatroom info ->".concat(e)),[4,this._context.getChatroomInfo(this._id,t.count,t.order)];case 1:return n=a.sent(),o=n.code,r=n.data,o===s.SUCCESS&&r?[2,r]:(ct.warn("get chatroom info fail ->code+:".concat(dt[o],",").concat(e)),[2,Promise.reject({code:o,msg:dt[o]})])}}))}))},t.prototype.setEntry=function(t){return P(this,void 0,void 0,(function(){var e,n;return L(this,(function(o){switch(o.label){case 0:return jt(t),e="id:".concat(this._id),ct.debug("set chatroom entry->".concat(e)),[4,this._context.setChatroomEntry(this._id,t)];case 1:return(n=o.sent())!==s.SUCCESS?(ct.warn("set chatroom entry fail ->code+:".concat(dt[n],",").concat(e)),[2,Promise.reject({code:n,msg:dt[n]})]):[2]}}))}))},t.prototype.setEntries=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r;return L(this,(function(a){switch(a.label){case 0:return function(t){t.entries.forEach((function(t){d("entry.key",t.key,g.STRING,!0),d("entry.value",t.value,g.STRING,!0)})),d("options.isAutoDelete",t.isAutoDelete,g.BOOLEAN),d("options.notificationExtra",t.notificationExtra,g.STRING)}(t),t.entries.length>10?[2,Promise.reject(ut.CHATROOM_KV_STORE_OUT_LIMIT)]:(e="id:".concat(this._id),ct.debug("set chatroom entry->".concat(e)),[4,this._context.setChatroomEntries(this._id,t)]);case 1:return n=a.sent(),o=n.code,r=n.data,o!==s.SUCCESS?(ct.warn("set chatroom entry fail ->code+:".concat(dt[o],",").concat(e)),[2,Promise.reject({code:o,msg:dt[o],data:r})]):[2]}}))}))},t.prototype.forceSetEntry=function(t){return P(this,void 0,void 0,(function(){var e,n;return L(this,(function(o){switch(o.label){case 0:return jt(t),e="id:".concat(this._id),ct.debug("force set chatroom entry ->".concat(e)),[4,this._context.forceSetChatroomEntry(this._id,t)];case 1:return(n=o.sent())!==s.SUCCESS?(ct.warn("force set chatroom entry fail ->code+:".concat(dt[n],",").concat(e)),[2,Promise.reject({code:n,msg:dt[n]})]):[2]}}))}))},t.prototype.removeEntry=function(t){return P(this,void 0,void 0,(function(){var e,n;return L(this,(function(o){switch(o.label){case 0:return Bt(t),e="id:".concat(this._id),ct.debug("remove chatroom entry->".concat(e)),[4,this._context.removeChatroomEntry(this._id,t)];case 1:return(n=o.sent())!==s.SUCCESS?(ct.warn("remove chatroom entry fail ->code+:".concat(dt[n],",").concat(e)),[2,Promise.reject({code:n,msg:dt[n]})]):[2]}}))}))},t.prototype.removeEntries=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r,a;return L(this,(function(i){switch(i.label){case 0:return function(t){t.entries.forEach((function(t){d("key",t,g.STRING,!0)}))}(t),e="id:".concat(this._id),ct.debug("remove chatroom entry->".concat(e)),(n=x({},t)).entries=t.entries.map((function(t){return{key:t}})),[4,this._context.removeChatroomEntries(this._id,n)];case 1:return o=i.sent(),r=o.code,a=o.data,r!==s.SUCCESS?(ct.warn("remove chatroom entry fail ->code+:".concat(dt[r],",").concat(e)),[2,Promise.reject({code:r,msg:dt[r],data:a})]):[2]}}))}))},t.prototype.forceRemoveEntry=function(t){return P(this,void 0,void 0,(function(){var e,n;return L(this,(function(o){switch(o.label){case 0:return Bt(t),e="id:".concat(this._id),ct.debug("force remove chatroom entry ->".concat(e)),[4,this._context.forceRemoveChatroomEntry(this._id,t)];case 1:return(n=o.sent())!==s.SUCCESS?(ct.warn("force remove chatroom entry fail ->code+:".concat(dt[n],",").concat(e)),[2,Promise.reject({code:n,msg:dt[n]})]):[2]}}))}))},t.prototype.getEntry=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r;return L(this,(function(a){switch(a.label){case 0:return d("key",t,(function(t){return p(t)&&/[\w+=-]+/.test(t)&&t.length<=128}),!0),e="id:".concat(this._id),ct.debug("get chatroom entry->".concat(e)),[4,this._context.getChatroomEntry(this._id,t)];case 1:return n=a.sent(),o=n.code,r=n.data,o===s.SUCCESS&&r?[2,r]:(ct.warn("get chatroom entry fail ->code+:".concat(dt[o],",").concat(e)),[2,Promise.reject({code:o,msg:dt[o]})])}}))}))},t.prototype.getAllEntries=function(){return P(this,void 0,void 0,(function(){var t,e,n,o;return L(this,(function(r){switch(r.label){case 0:return t="id:".concat(this._id),ct.debug("get all chatroom entries->".concat(t)),[4,this._context.getAllChatroomEntries(this._id)];case 1:return e=r.sent(),n=e.code,o=e.data,n===s.SUCCESS&&o?[2,o]:(ct.warn("get all chatroom entries fail ->code+:".concat(dt[n],",").concat(t)),[2,Promise.reject({code:n,msg:dt[n]})])}}))}))},t.prototype.send=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r,c;return L(this,(function(u){switch(u.label){case 0:return Et(t),e="id:".concat(this._id),ct.debug("send chatroom message ->".concat(e)),Object.prototype.hasOwnProperty.call(t,"isPersited")||(t.isPersited=!0),Object.prototype.hasOwnProperty.call(t,"isCounted")||(t.isCounted=!0),n=a.ID(),a.info(i.A_SEND_MSG_T,{messageType:t.messageType,conversationType:I.CHATROOM,channelId:t.channelId},{traceId:n}),[4,this._context.sendMessage(I.CHATROOM,this._id,t,void 0,n)];case 1:return o=u.sent(),r=o.code,c=o.data,(r===s.SUCCESS?a.info:a.warn)(i.A_SEND_MSG_R,{code:r,messageUId:c?c.messageUId:"",messageId:c?c.messageId:""},{traceId:n}),r===s.SUCCESS?[2,_t(c)]:(ct.warn("send chatroom message fail ->code+:".concat(dt[r],",").concat(e)),[2,Promise.reject({code:r,msg:dt[r]})])}}))}))},t.prototype.getMessages=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r;return L(this,(function(a){switch(a.label){case 0:return d("options.timestamp",t.timestamp,g.NUMBER),d("options.count",t.count,g.NUMBER),d("options.order",t.order,(function(t){return 0===t||1===t})),e="id:".concat(this._id),ct.debug("get chatroom history message->".concat(e)),[4,this._context.getChatRoomHistoryMessages(this._id,t.count,t.order,t.timestamp)];case 1:return n=a.sent(),o=n.code,r=n.data,o===s.SUCCESS&&r?[2,{list:r.list.map((function(t){return _t(t)})),hasMore:r.hasMore}]:(ct.warn("get chatroom history message fail ->code+:".concat(dt[o],",").concat(e)),[2,Promise.reject({code:o,msg:dt[o]})])}}))}))},t.prototype.recall=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r,a;return L(this,(function(i){switch(i.label){case 0:return d("options.messageUId",t.messageUId,g.STRING,!0),d("options.sentTime",t.sentTime,g.NUMBER,!0),e="id:".concat(this._id,",messageUId:").concat(t.messageUId),ct.debug("chatroom recall->".concat(e)),n=I.CHATROOM,[4,this._context.recallMessage(n,this._id,t.messageUId,t.sentTime,{channelId:"",user:t.user})];case 1:return o=i.sent(),r=o.code,a=o.data,r===s.SUCCESS&&a?[2,_t(a)]:(ct.warn("chatroom recall fail->code+:".concat(dt[r],",").concat(e)),[2,Promise.reject({code:r,msg:dt[r]})])}}))}))},t}(),Kt=function(){function t(t){this._context=t}return t.prototype.get=function(t){return d("option.id",t.id,T,!0),new Gt(this._context,t.id)},t}(),Ht=function(){function t(t,e){this._options=t,this._context=e,this._roomId=t.id}return t.prototype.join=function(){return P(this,void 0,void 0,(function(){var t,e,n,o;return L(this,(function(r){switch(r.label){case 0:return t="roomId:".concat(this._roomId),ct.debug("join ->".concat(t)),[4,this._context.joinRTCRoom(this._roomId,this._options.mode,this._options.broadcastType)];case 1:return e=r.sent(),n=e.code,o=e.data,n===s.SUCCESS?[2,o]:(ct.warn("join fail ->".concat(n,":").concat(dt[n],",").concat(t)),[2,Promise.reject(n)])}}))}))},t.prototype.quit=function(){return P(this,void 0,void 0,(function(){var t,e;return L(this,(function(n){switch(n.label){case 0:return t="roomId:".concat(this._roomId),ct.debug("quit ->".concat(t)),[4,this._context.quitRTCRoom(this._roomId)];case 1:return(e=n.sent())===s.SUCCESS?[2,e]:(ct.warn("quit fail ->".concat(e,":").concat(dt[e],",").concat(t)),[2,Promise.reject(e)])}}))}))},t.prototype.getRoomInfo=function(){return P(this,void 0,void 0,(function(){var t,e,n,o;return L(this,(function(r){switch(r.label){case 0:return t="roomId:".concat(this._roomId),ct.debug("get roomInfo ->".concat(t)),[4,this._context.getRTCRoomInfo(this._roomId)];case 1:return e=r.sent(),n=e.code,o=e.data,n===s.SUCCESS?[2,o]:(ct.warn("get roomInfo fail ->".concat(n,":").concat(dt[n],",").concat(t)),[2,Promise.reject(n)])}}))}))},t.prototype.setUserInfo=function(t){return P(this,void 0,void 0,(function(){var e,n;return L(this,(function(o){switch(o.label){case 0:return e="roomId:".concat(this._roomId,",key:").concat(t.key,",value:").concat(t.value),ct.debug("set userInfo ->".concat(e)),[4,this._context.setRTCUserInfo(this._roomId,t.key,t.value)];case 1:return(n=o.sent())===s.SUCCESS?[2,n]:(ct.warn("set userInfo fail ->".concat(n,":").concat(dt[n],",").concat(e)),[2,Promise.reject(n)])}}))}))},t.prototype.removeUserInfo=function(t){return P(this,void 0,void 0,(function(){var e,n;return L(this,(function(o){switch(o.label){case 0:return e="roomId:".concat(this._roomId,",keys:").concat((t.keys||[]).join(",")),ct.debug("remove useerInfo ->".concat(e)),[4,this._context.removeRTCUserInfo(this._roomId,t.keys)];case 1:return(n=o.sent())===s.SUCCESS?[2,n]:(ct.warn("remove userInfo fail ->".concat(n,":").concat(dt[n],",").concat(e)),[2,Promise.reject(n)])}}))}))},t.prototype.setData=function(t,e,n,o,r){return P(this,void 0,void 0,(function(){var a,i;return L(this,(function(c){switch(c.label){case 0:return a="roomId:".concat(this._roomId,",key:").concat(t,",value:").concat(e),ct.debug("set data ->".concat(a)),[4,this._context.setRTCData(this._roomId,t,e,n,o,r)];case 1:return(i=c.sent())===s.SUCCESS?[2,i]:(ct.warn("set data fail ->".concat(i,":").concat(dt[i],",").concat(a)),[2,Promise.reject(i)])}}))}))},t.prototype.setUserData=function(t,e,n,o){return this.setData(t,e,n,E.PERSON,o)},t.prototype.setRTCUserData=function(t,e,n){return P(this,void 0,void 0,(function(){var o,r;return L(this,(function(a){switch(a.label){case 0:return o="roomId:".concat(this._roomId),ct.debug("set rtc user ->".concat(o)),[4,this._context.setRTCTotalRes(this._roomId,t,e,n)];case 1:return(r=a.sent())===s.SUCCESS?[2,r]:(ct.warn("set rtc user fail ->".concat(r,":").concat(dt[r],",").concat(o)),[2,Promise.reject(r)])}}))}))},t.prototype.getData=function(t,e,n){return P(this,void 0,void 0,(function(){var o,r,a,i;return L(this,(function(c){switch(c.label){case 0:return o="roomId:".concat(this._roomId),ct.debug("get data ->".concat(o)),[4,this._context.getRTCData(this._roomId,t,e,n)];case 1:return r=c.sent(),a=r.code,i=r.data,a===s.SUCCESS?[2,i]:(ct.warn("get data fail ->".concat(a,":").concat(dt[a],",").concat(o)),[2,Promise.reject(a)])}}))}))},t.prototype.getUserData=function(t,e){return this.getData(t,e,E.PERSON)},t.prototype.removeData=function(t,e,n,o){return P(this,void 0,void 0,(function(){var r,a;return L(this,(function(i){switch(i.label){case 0:return r="roomId:".concat(this._roomId,",keys:").concat(t.join(",")),ct.debug("remove data ->".concat(r)),[4,this._context.removeRTCData(this._roomId,t,e,n,o)];case 1:return(a=i.sent())===s.SUCCESS?[2,a]:(ct.warn("remove data fail ->".concat(a,":").concat(dt[a],",").concat(r)),[2,Promise.reject(a)])}}))}))},t.prototype.removeUserData=function(t,e,n){return this.removeData(t,e,E.PERSON,n)},t.prototype.setRoomData=function(t,e,n,o){return this.setData(t,e,n,E.ROOM,o)},t.prototype.getRoomData=function(t,e){return this.getData(t,e,E.ROOM)},t.prototype.removeRoomData=function(t,e,n){return this.removeData(t,e,E.ROOM,n)},t.prototype.setState=function(t){return P(this,void 0,void 0,(function(){var e,n;return L(this,(function(o){switch(o.label){case 0:return e="roomId:".concat(this._roomId),ct.debug("set state ->".concat(e)),[4,this._context.setRTCState(this._roomId,t.report)];case 1:return(n=o.sent())===s.SUCCESS?[2,n]:(ct.warn("set state fail ->".concat(n,":").concat(dt[n],",").concat(e)),[2,Promise.reject(n)])}}))}))},t.prototype.getUserList=function(){return P(this,void 0,void 0,(function(){var t,e,n,o;return L(this,(function(r){switch(r.label){case 0:return t="roomId:".concat(this._roomId),ct.debug("get userList ->".concat(t)),[4,this._context.getRTCUserInfoList(this._roomId)];case 1:return e=r.sent(),n=e.code,o=e.data,n===s.SUCCESS?[2,o]:(ct.warn("get userList fail ->".concat(n,":").concat(dt[n],",").concat(t)),[2,Promise.reject(n)])}}))}))},t.prototype.getUserInfoList=function(){return P(this,void 0,void 0,(function(){var t,e,n,o;return L(this,(function(r){switch(r.label){case 0:return t="roomId:".concat(this._roomId),ct.debug("get userInfo list ->".concat(t)),[4,this._context.getRTCUserInfoList(this._roomId)];case 1:return e=r.sent(),n=e.code,o=e.data,n===s.SUCCESS?[2,null==o?void 0:o.users]:(ct.warn("get userInfo list fail ->".concat(n,":").concat(dt[n],",").concat(t)),[2,Promise.reject(n)])}}))}))},t.prototype.getToken=function(){return P(this,void 0,void 0,(function(){var t,e,n,o;return L(this,(function(r){switch(r.label){case 0:return t="roomId:".concat(this._roomId),ct.debug("getToken ->".concat(t)),[4,this._context.getRTCToken(this._roomId,this._options.mode,this._options.broadcastType)];case 1:return e=r.sent(),n=e.data,(o=e.code)===s.SUCCESS?[2,n]:(ct.warn("getToken fail ->".concat(o,":").concat(dt[o],",").concat(t)),[2,Promise.reject(o)])}}))}))},t.prototype.ping=function(){return P(this,void 0,void 0,(function(){var t,e;return L(this,(function(n){switch(n.label){case 0:return t="roomId:".concat(this._roomId),ct.debug("ping ->".concat(t)),[4,this._context.rtcPing(this._roomId,this._options.mode,this._options.broadcastType)];case 1:return(e=n.sent())===s.SUCCESS?[2,e]:(ct.warn("ping fail ->".concat(e,":").concat(dt[e],",").concat(t)),[2,Promise.reject(e)])}}))}))},t.prototype.send=function(t){return P(this,void 0,void 0,(function(){var e,n,o,r;return L(this,(function(a){switch(a.label){case 0:return e="roomId:".concat(this._roomId),ct.debug("send ->".concat(e)),[4,this._context.sendMessage(I.RTC_ROOM,this._roomId,{content:x({},t.content),messageType:t.messageType})];case 1:return n=a.sent(),o=n.code,r=n.data,o===s.SUCCESS?[2,r]:(ct.warn("send fail ->".concat(o,":").concat(dt[o],",").concat(e)),[2,Promise.reject(o)])}}))}))},t}();R.add("imlib-v4-adapter","5.5.1");var Vt,Ft=[],qt=[],Wt={message:function(t){Ft.forEach((function(e){return e(t)}))},status:function(t){qt.forEach((function(e){return e(t)}))}},Xt=function(){function t(t){this._token="",this._context=t,this.Conversation=new Lt(t),this.ChatRoom=new Kt(t),this.Tag=new Dt(t),this.RTC=function(e){return d("options.id",e.id,T,!0),new Ht(e,t)}}return t.prototype.install=function(t,e){return this._context.install(t,e)},t.prototype.watch=function(t){var e=t.status,n=t.conversation,o=t.message,r=t.chatroom,s=t.expansion,c=t.typingStatus,u=t.pullFinished,d=t.messageBlocked,g=t.tag,f={};if(e){var h=a.ID();f.connectionState=function(t){try{a.info(i.A_CONNECT_S,{status:t},{traceId:h}),e({status:t})}catch(t){ct.error(t)}}}n&&(f.conversationState=function(t){try{var e=t.map((function(t){return n=(e=t).updatedItems,o=e.conversationType,r=e.targetId,s=e.latestMessage,a=e.unreadMessageCount,i=e.lastUnreadTime,c=e.notificationStatus,u=e.isTop,d=e.mentionedInfo,g=e.hasMentioned,f=s&&_t(s),n&&n.latestMessage&&(n.latestMessage.val=f),{updatedItems:n,type:o,targetId:r,latestMessage:f,unreadMessageCount:a,lastUnreadTime:i,notificationStatus:c,isTop:u,mentionedInfo:d,hasMentioned:g};var e,n,o,r,s,a,i,c,u,d,g,f}));n({updatedConversationList:e})}catch(t){ct.error(t)}}),o&&(f.message=function(t){try{var e=_t(t);a.info(i.A_PULL_MSG_O,{message:e.messageUId}),o({message:e})}catch(t){ct.error(t)}}),r&&(f.chatroomState=function(t){try{r(t)}catch(t){ct.error(t)}}),s&&(f.expansion=function(t){try{s(t)}catch(t){ct.error(t)}}),u&&(f.pullFinished=function(){try{u()}catch(t){ct.error(t)}}),c&&(f.typingState=function(t){try{c(t)}catch(t){ct.error(t)}}),d&&(f.messageBlocked=function(t){try{d(t)}catch(t){ct.error(t)}}),g&&(f.tag=function(){try{g()}catch(t){ct.error(t)}}),this._context.assignWatcher(f)},t.prototype.unwatch=function(){this._context.assignWatcher({message:void 0,connectionState:void 0,conversationState:void 0,chatroomState:void 0,expansion:void 0,pullFinished:void 0,typingState:void 0,messageBlocked:void 0})},t.prototype.rtcInnerWatch=function(t){var e=t.message,n=t.status;e&&Ft.push((function(t){try{e({message:_t(t)})}catch(t){ct.error(t)}})),n&&qt.push((function(t){try{n({status:t})}catch(t){ct.error(t)}})),this._context.assignWatcher({rtcInnerWatcher:Wt})},t.prototype.rtcInnerUnwatch=function(){qt.length=qt.length=0,this._context.assignWatcher({rtcInnerWatcher:void 0})},t.prototype.connect=function(t){return P(this,void 0,void 0,(function(){var e,n,o;return L(this,(function(r){switch(r.label){case 0:return d("options.token",t.token,g.STRING,!0),e=t.token,this._token=e,n=a.ID(),a.info(i.A_CONNECT_T,{token:e,reconnectKickEnable:!1},{traceId:n}),[4,this._context.connect(e,!1,!1,n)];case 1:return o=r.sent(),(o.code===s.SUCCESS?a.info:a.warn)(i.A_CONNECT_R,{code:o.code,userId:o.userId},{traceId:n}),o.code===s.SUCCESS?[2,{id:o.userId}]:[2,Promise.reject({code:o.code,msg:dt[o.code]})]}}))}))},t.prototype.reconnect=function(){return P(this,void 0,void 0,(function(){var t;return L(this,(function(e){switch(e.label){case 0:return[4,this._context.reconnect()];case 1:return(t=e.sent()).code===s.SUCCESS?[2,{id:t.userId}]:[2,Promise.reject({code:t.code,msg:dt[t.code]})]}}))}))},t.prototype.disconnect=function(){return a.info(i.A_DISCONNECT_O,{}),this._context.disconnect()},t.prototype.getAppInfo=function(){return{appkey:this._context.appkey,token:this._token,navi:this._context.getInfoFromCache()}},t.prototype.getConnectedTime=function(){return this._context.getConnectedTime()},t.prototype.getServerTime=function(){return this._context.getServerTime()},t.prototype.getConnectionStatus=function(){return this._context.getConnectionStatus()},t.prototype.getConnectionUserId=function(){return this._context.getCurrentUserId()},t.prototype.getFileToken=function(t,e,n,o){return d("fileType",t,N,!0),this._context.getFileToken(t,e,n,o)},t.prototype.getFileUrl=function(t,e,n,o,r){return d("fileType",t,N,!0),d("filename",e,g.STRING),d("saveName",n,g.STRING),d("serverType",r,g.NUMBER),this._context.getFileUrl(t,e,n,o,r)},t.prototype.changeUser=function(t){return P(this,void 0,void 0,(function(){return L(this,(function(e){switch(e.label){case 0:return ct.warn("Method is deprecated"),d("options.token",t.token,g.STRING,!0),[4,this.disconnect()];case 1:return e.sent(),[2,this.connect(t)]}}))}))},t.prototype.registerMessageType=function(t,e,n,o){this._context.registerMessageType(t,e,n,o)},t}(),Yt=function(t){if(ct.setLogLevel(t.logLevel),ct.setLogStdout(t.logStdout),Vt)return ct.error("The instance already exists. Do not repeatedly call the init method"),Vt;d("options.appkey",t.appkey,g.STRING,!0),d("options.debug",t.debug,g.BOOLEAN),d("options.navigators",t.navigators,(function(t){return h(t)&&(0===t.length||t.every(O))}));var e=null==t?void 0:t.connectType;e?M.WEBSOCKET!==e&&M.COMET!==e&&(ct.warn("RongIMLib connectionType must be ".concat(M.WEBSOCKET," or ").concat(M.COMET)),e=M.WEBSOCKET):e=M.WEBSOCKET,a.info(i.A_INIT_O,{appkey:t.appkey,navigators:t.navigators||[],connectionType:e,logLevel:t.logLevel});var n=U.init(it,{appkey:t.appkey,apiVersion:"5.5.1",navigators:t.navigators||[],miniCMPProxy:t.customCMP||[],connectionType:e,logLevel:t.logLevel,logStdout:t.logStdout,indexDBSwitch:t.indexDBSwitch,checkCA:t.checkCA});return ct.warn("RongIMLib Version: ".concat("5.5.1",", Commit: ").concat("70d3b5ba00858e4afab4a3c616424ad5879a8131")),Vt=new Xt(n)},Jt=function(){return Vt||ct.error("Please call the init method first"),Vt},Qt=_,zt=I,Zt=b,$t={DO_NOT_DISTURB:w.OPEN,NOTIFY:w.CLOSE},te=A;export{te as CHATROOM_ENTRY_TYPE,lt as CHATROOM_ORDER,ht as CONNECTION_STATUS,pt as CONNECT_TYPE,zt as CONVERSATION_TYPE,Gt as Chatroom,Kt as ChatroomModule,Pt as Conversation,Lt as ConversationModule,dt as ERROR_CODE,Zt as FILE_TYPE,Xt as IMClient,It as MENTIONED_TYPE,Qt as MESSAGE_DIRECTION,St as MESSAGE_TYPE,mt as MESSAGS_TIME_ORDER,$t as NOTIFICATION_STATUS,vt as RECALL_MESSAGE_TYPE,yt as RECEIVED_STATUS,Ht as RTCClient,Ct as SDK_VERSION,kt as Tag,Dt as TagModule,Jt as getInstance,Yt as init};
